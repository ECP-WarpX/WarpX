# DD fusion in a straight cylinder:
#
#           | He-3 + n (neutronic branch, 50% probability)
# d + d -> <
#           | t + p    (anneutronic branch, 50% probability)
#
# Sim params are dialed in to produce about 11,000 physical particles of
# each fusion-product species (and ~1,300 macro particles)
# However, as of 03/23/2023, anneutronic DD fusion is broken:
# amrex::Abort::0::ERROR: Product species of proton-boron fusion must be of type helium3 and neutron, or tritium and proton !!!

my_constants.density = 1.e18
my_constants.u0 = 7.5e-3 # Td ~158 keV, u0 = 3.e-2 is close to optimal for fusion yield
my_constants.fusion_multiplier = 1.e8

my_constants.rmax = 5.e-2
my_constants.nr = 48
my_constants.Lz = 10.e-2
my_constants.nz = 96
my_constants.dt = 1.e-8

warpx.const_dt = dt
max_step = 100 # 1 us
amr.n_cell = nr nz
amr.max_level = 0
amr.blocking_factor = 8
amr.max_grid_size = 128
geometry.dims = RZ

algo.maxwell_solver = none
boundary.field_lo = none Periodic
boundary.field_hi =  pec Periodic

boundary.particle_lo = Reflecting Periodic
boundary.particle_hi = Reflecting Periodic # Bounce particles off cylinder wall

geometry.prob_lo =    0 -Lz/2
geometry.prob_hi = rmax  Lz/2

particles.species_names = electrons protons deuterons tritons helions neutrons
#particles.species_names = electrons deuterons helions neutrons

electrons.species_type = electron
electrons.injection_style = NRandomPerCell
electrons.num_particles_per_cell = 100
electrons.profile = constant
electrons.density = density
electrons.momentum_distribution_type = gaussian
electrons.ux_th = 0.036091520857259175 # 1 keV (1/3 keV in each direction)
electrons.uy_th = 0.036091520857259175
electrons.uz_th = 0.036091520857259175
electrons.do_not_push = 1
electrons.do_not_deposit = 1

protons.species_type = protium #proton
protons.injection_style = none
protons.do_not_push = 1
protons.do_not_deposit = 1

deuterons.species_type = deuterium
deuterons.injection_style = NRandomPerCell
deuterons.num_particles_per_cell = 100
deuterons.profile = constant
deuterons.density = density
deuterons.momentum_distribution_type = gaussian
deuterons.ux_th = u0
deuterons.uy_th = u0
deuterons.uz_th = u0
deuterons.do_not_push = 1
deuterons.do_not_deposit = 1

tritons.species_type = tritium #hydrogen3
tritons.injection_style = none
tritons.do_not_push = 1
tritons.do_not_deposit = 1

helions.species_type = helium3
helions.injection_style = none
helions.do_not_push = 1
helions.do_not_deposit = 1

neutrons.species_type = neutron
neutrons.injection_style = none
neutrons.do_not_push = 1
neutrons.do_not_deposit = 1

algo.particle_shape = 1

collisions.collision_names = dd_fusion_he3n dd_fusion_tp

# Fusion reactions

dd_fusion_he3n.type = nuclearfusion
dd_fusion_he3n.species = deuterons deuterons
dd_fusion_he3n.product_species = helions neutrons
dd_fusion_he3n.fusion_multiplier = fusion_multiplier

dd_fusion_tp.type = nuclearfusion
dd_fusion_tp.species = deuterons deuterons
dd_fusion_tp.product_species = tritons protons
dd_fusion_tp.fusion_multiplier = fusion_multiplier

warpx.reduced_diags_names = PN PE
PN.type = ParticleNumber
PN.intervals = 1
PE.type = ParticleEnergy
PE.intervals = 1
