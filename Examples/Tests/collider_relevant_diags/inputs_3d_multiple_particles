#################################
########## MY CONSTANTS #########
#################################
my_constants.mc2 = 0.510998950e6
my_constants.ps = 1.0e-12
my_constants.mm = 1.0e-3
# BOX
my_constants.Lx = 5.
my_constants.Ly = 5.
my_constants.Lz = 5.

my_constants.nx = 8
my_constants.ny = 8
my_constants.nz = 8
my_constants.dx = Lx/nx
my_constants.dy = Ly/ny
my_constants.dy = Lz/nz

# TIME
my_constants.cfl = 0.99
my_constants.dt = cfl/clight/sqrt((1./dx)^2+(1./dy)^2+(1./dz)^2)

# DIAGS
my_constants.every_ps = floor(ps/dt)
my_constants.out_freq_red = 10
my_constants.out_freq_full = 10 #0.01*every_ps

#################################
####### GENERAL PARAMETERS ######
#################################
max_step = 3
amr.n_cell = nx ny nz
#amr.max_grid_size = 64
#amr.blocking_factor = 2
warpx.numprocs = 1 1 1
amr.max_level = 0
geometry.dims = 3
geometry.prob_lo = 0 0 0
geometry.prob_hi =  8 8 8
particles.do_tiling = 0
warpx.use_filter = 0


#################################
######## BOUNDARY CONDITION #####
#################################
boundary.field_lo = periodic periodic periodic
boundary.field_hi = periodic periodic periodic
boundary.particle_lo = periodic periodic periodic
boundary.particle_hi = periodic periodic periodic

#################################
############ NUMERICS ###########
#################################
algo.maxwell_solver = ckc
warpx.cfl = cfl
algo.particle_shape = 1
algo.load_balance_intervals=100

#################################
############ FIELDS #############
#################################
particles.E_ext_particle_init_style = constant
particles.B_ext_particle_init_style = constant
particles.E_external_particle = 10000. 0. 0.
particles.B_external_particle = 0. 5000. 0.

#################################
########### PARTICLES ###########
#################################
particles.species_names = beam_p beam_e pho
particles.photon_species = pho

beam_e.species_type = electron
beam_e.injection_style = MultipleParticles
beam_e.multiple_particles_pos_x = 4.5  3.5  0.5
beam_e.multiple_particles_pos_y = 4.5  2.5  1.5
beam_e.multiple_particles_pos_z = 4.5  1.5  1.5
beam_e.multiple_particles_ux = 0.3 0.2 0.1
beam_e.multiple_particles_uy = 0.4 -0.3 -0.1
beam_e.multiple_particles_uz = 0.3 0.1 -10.
beam_e.multiple_particles_weight = 1. 2 3
beam_e.initialize_self_fields = 0
beam_e.self_fields_required_precision = 5e-10
beam_e.do_qed_quantum_sync = 1
beam_e.qed_quantum_sync_phot_product_species = pho
beam_e.do_not_push = 1
beam_e.do_not_deposit = 1

beam_p.species_type = positron
beam_p.injection_style = MultipleParticles
beam_p.multiple_particles_pos_x = 4.5 3.5 0.5
beam_p.multiple_particles_pos_y = 4.5 2.5 1.5
beam_p.multiple_particles_pos_z = 4.5 1.5 1.5
beam_p.multiple_particles_ux = 0.3 0.2 0.1
beam_p.multiple_particles_uy = 0.4 -0.3 -0.1
beam_p.multiple_particles_uz = 0.3 0.1 -10.
beam_p.multiple_particles_weight = 1. 2 3
beam_p.initialize_self_fields = 0
beam_p.self_fields_required_precision = 5e-10
beam_p.do_qed_quantum_sync = 1
beam_p.qed_quantum_sync_phot_product_species = pho
beam_p.do_not_push = 1
beam_p.do_not_deposit = 1

pho.species_type = photon
pho.injection_style = none

#################################
############# QED ###############
#################################
qed_qs.photon_creation_energy_threshold = 0.

qed_qs.lookup_table_mode = builtin
qed_qs.chi_min = 1.e-3
qed_bw.lookup_table_mode = builtin
qed_bw.chi_min = 1.e-2

warpx.do_qed_schwinger = 0

#################################
######### DIAGNOSTICS ###########
#################################
# FULL
diagnostics.diags_names = diag1 diag2
diag1.intervals = 1 #out_freq_full
diag1.diag_type = Full
diag1.write_species = 1
diag1.fields_to_plot = Ex Ey Ez Bx By Bz jx jy jz rho_beam_e rho_beam_p rho
diag1.species = pho beam_e beam_p
diag1.format = openpmd
diag1.openpmd_backend = bp
diag1.dump_last_timestep = 1

diag2.intervals = 1 #out_freq_full
diag2.diag_type = Full
diag2.write_species = 1
diag2.fields_to_plot = Ex Ey Ez Bx By Bz jx jy jz rho_beam_e rho_beam_p rho
diag2.species = pho beam_e beam_p
diag2.format = plotfile
diag2.dump_last_timestep = 1

# REDUCED
warpx.reduced_diags_names = FieldEnergy FieldMomentum FieldMaximum ParticleExtrema_beam_e ParticleExtrema_beam_p ParticleExtrema_pho ParticleEnergy ParticleMomentum RhoMaximum ParticleNumber BeamRelevant_beam_e BeamRelevant_beam_p BeamRelevant_pho ColliderRelevant_beam_e_beam_p

ColliderRelevant_beam_e_beam_p.type = ColliderRelevant
ColliderRelevant_beam_e_beam_p.intervals = 1
ColliderRelevant_beam_e_beam_p.species =beam_e beam_p

FieldEnergy.type = FieldEnergy
FieldEnergy.intervals = out_freq_red

FieldMomentum.type = FieldMomentum
FieldMomentum.intervals = out_freq_red

FieldMaximum.type = FieldMaximum
FieldMaximum.intervals = out_freq_red

ParticleExtrema_beam_e.type = ParticleExtrema
ParticleExtrema_beam_e.intervals = 1
ParticleExtrema_beam_e.species = beam_e

ParticleExtrema_beam_p.type = ParticleExtrema
ParticleExtrema_beam_p.intervals = 1
ParticleExtrema_beam_p.species = beam_p

ParticleExtrema_pho.type = ParticleExtrema
ParticleExtrema_pho.intervals = out_freq_red
ParticleExtrema_pho.species = pho

ParticleEnergy.type = ParticleEnergy
ParticleEnergy.intervals = out_freq_red

ParticleMomentum.type = ParticleMomentum
ParticleMomentum.intervals = out_freq_red

RhoMaximum.type = RhoMaximum
RhoMaximum.intervals = out_freq_red

ParticleNumber.type = ParticleNumber
ParticleNumber.intervals = out_freq_red

BeamRelevant_beam_e.type = BeamRelevant
BeamRelevant_beam_e.species = beam_e
BeamRelevant_beam_e.intervals = out_freq_red

BeamRelevant_beam_p.type= BeamRelevant
BeamRelevant_beam_p.species = beam_p
BeamRelevant_beam_p.intervals = out_freq_red

BeamRelevant_pho.type = BeamRelevant
BeamRelevant_pho.species = pho
BeamRelevant_pho.intervals = out_freq_red
