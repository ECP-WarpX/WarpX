name: üêß In Situ Vis with Ascent

on: [push, pull_request]

concurrency:
  group: ${{ github.ref }}-${{ github.head_ref }}-insituvis
  cancel-in-progress: true

jobs:
  ascent:
    name: Ascent
    runs-on: ubuntu-20.04
    if: github.event.pull_request.draft == false
    env:
      CXX: g++
      CC: gcc
      CMAKE_PREFIX_PATH: /home/user/ascent/install-debug/lib/cmake/
    container:
      image: alpinedav/ascent:ascent-ubuntu-18_2021-10-23-shaba7872
    steps:
    - uses: actions/checkout@v2
    - name: Configure
      run: |
        . ../s_env.sh && cmake -S . -B build               \
                                    -DWarpX_ASCENT=ON      \
                                    -DWarpX_COMPUTE=NOACC
    - name: Build
      run: |
        . ../s_env.sh && cmake --build build -j 2