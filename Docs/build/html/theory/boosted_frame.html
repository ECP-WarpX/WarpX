

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Moving window and optimal Lorentz boosted frame &mdash; WarpX  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Inputs and outputs" href="input_output.html" />
    <link rel="prev" title="Boundary conditions" href="PML.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WarpX
          

          
          </a>

          
            
            
              <div class="version">
                20.02
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../building/building.html">Building/installing WarpX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_cpp/running_cpp.html">Running WarpX as an executable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_python/running_python.html">Running WarpX from Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/visualization.html">Visualizing the simulation results</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="theory.html">Theoretical background</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="picsar_theory.html">The electromagnetic Particle-In-Cell method</a></li>
<li class="toctree-l2"><a class="reference internal" href="picsar_theory.html#filtering">Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="amr.html">Mesh refinement</a></li>
<li class="toctree-l2"><a class="reference internal" href="PML.html">Boundary conditions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Moving window and optimal Lorentz boosted frame</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#theoretical-speedup-dependency-with-the-frame-boost">Theoretical speedup dependency with the frame boost</a></li>
<li class="toctree-l3"><a class="reference internal" href="#numerical-stability-and-alternate-formulation-in-a-galilean-frame">Numerical Stability and alternate formulation in a Galilean frame</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="input_output.html">Inputs and outputs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developers/developers.html">Developers documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/doxygen.html">Doxygen</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WarpX</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="theory.html">Theoretical background</a> &raquo;</li>
        
      <li>Moving window and optimal Lorentz boosted frame</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/theory/boosted_frame.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="moving-window-and-optimal-lorentz-boosted-frame">
<h1>Moving window and optimal Lorentz boosted frame<a class="headerlink" href="#moving-window-and-optimal-lorentz-boosted-frame" title="Permalink to this headline">¶</a></h1>
<p>The simulations of plasma accelerators from first principles are extremely computationally intensive, due to the need to resolve the evolution of a driver (laser or particle beam) and an accelerated particle beam into a plasma structure that is orders of magnitude longer and wider than the accelerated beam. As is customary in the modeling of particle beam dynamics in standard particle accelerators, a moving window is commonly used to follow the driver, the wake and the accelerated beam. This results in huge savings, by avoiding the meshing of the entire plasma that is orders of magnitude longer than the other length scales of interest.</p>
<div class="figure align-default" id="id1">
<img alt="[fig:PIC] A first principle simulation of a short driver beam (laser or charged particles) propagating through a plasma that is orders of magnitude longer necessitates a very large number of time steps. Recasting the simulation in a frame of reference that is moving close to the speed of light in the direction of the driver beam leads to simulating a driver beam that appears longer propagating through a plasma that appears shorter than in the laboratory. Thus, this relativistic transformation of space and time reduces the disparity of scales, and thereby the number of time steps to complete the simulation, by orders of magnitude." src="../_images/Boosted_frame.png" />
<p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">[fig:PIC] A first principle simulation of a short driver beam (laser or charged particles) propagating through a plasma that is orders of magnitude longer necessitates a very large number of time steps. Recasting the simulation in a frame of reference that is moving close to the speed of light in the direction of the driver beam leads to simulating a driver beam that appears longer propagating through a plasma that appears shorter than in the laboratory. Thus, this relativistic transformation of space and time reduces the disparity of scales, and thereby the number of time steps to complete the simulation, by orders of magnitude.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>Even using a moving window, however, a full PIC simulation of a plasma accelerator can be extraordinarily demanding computationally, as many time steps are needed to resolve the crossing of the short driver beam with the plasma column. As it turns out, choosing an optimal frame of reference that travels close to the speed of light in the direction of the laser or particle beam (as opposed to the usual choice of the laboratory frame) enables speedups by orders of magnitude (Vay 2007; J -L. Vay et al. 2011). This is a result of the properties of Lorentz contraction and dilation of space and time. In the frame of the laboratory, a very short driver (laser or particle) beam propagates through a much longer plasma column, necessitating millions to tens of millions of time steps for parameters in the range of the BELLA or FACET-II experiments. As sketched in Fig. <a class="reference external" href="#fig:PIC">[fig:PIC]</a>, in a frame moving with the driver beam in the plasma at velocity <span class="math notranslate nohighlight">\(v=\beta c\)</span> (where <span class="math notranslate nohighlight">\(c\)</span> is the speed of light in vacuum), the beam length is now elongated by <span class="math notranslate nohighlight">\(\approx(1+\beta)\gamma\)</span> while the plasma contracts by <span class="math notranslate nohighlight">\(\gamma\)</span> (where <span class="math notranslate nohighlight">\(\gamma=1/\sqrt{1-\beta^2}\)</span> is the relativistic factor associated with the frame velocity). The number of time steps that is needed to simulate a “longer” beam through a “shorter” plasma is now reduced by up to <span class="math notranslate nohighlight">\(\approx(1+\beta) \gamma^2\)</span> (a detailed derivation of the speedup is given below).</p>
<p>The modeling of a plasma acceleration stage in a boosted frame
involves the fully electromagnetic modeling of a plasma propagating at near the speed of light, for which Numerical Cerenkov
(Boris and Lee 1973; Haber et al. 1973) is a potential issue, as explained in more details below.
In addition, for a frame of reference moving in the direction of the accelerated beam (or equivalently the wake of the laser),
waves emitted by the plasma in the forward direction expand
while the ones emitted in the backward direction contract, following the properties of the Lorentz transformation.
If one had to resolve both forward and backward propagating
waves emitted from the plasma, there would be no gain in selecting a frame different from the laboratory frame. However,
the physics of interest for a laser wakefield is the laser driving the wake, the wake, and the accelerated beam.
Backscatter is weak in the short-pulse regime, and does not
interact as strongly with the beam as do the forward propagating waves
which stay in phase for a long period. It is thus often assumed that the backward propagating waves
can be neglected in the modeling of plasma accelerator stages. The accuracy of this assumption has been demonstrated by
comparison between explicit codes which include both forward and backward waves and envelope or quasistatic codes which neglect backward waves
(Geddes et al. 2008; Geddes et al. 2009; Cowan et al. 2009).</p>
<div class="section" id="theoretical-speedup-dependency-with-the-frame-boost">
<h2>Theoretical speedup dependency with the frame boost<a class="headerlink" href="#theoretical-speedup-dependency-with-the-frame-boost" title="Permalink to this headline">¶</a></h2>
<p>The derivation that is given here reproduces the one given in (J -L. Vay et al. 2011), where the obtainable speedup is derived as an extension of the formula that was derived earlier(Vay 2007), taking in addition into account the group velocity of the laser as it traverses the plasma.</p>
<p>Assuming that the simulation box is a fixed number of plasma periods long, which implies the use (which is standard) of a moving window following
the wake and accelerated beam, the speedup is given by the ratio of the time taken by the laser pulse and the plasma to cross each other, divided by the shortest time scale of interest, that is the laser period. To first order, the wake velocity <span class="math notranslate nohighlight">\(v_w\)</span> is set by the 1D group velocity of the laser driver, which in the linear (low intensity) limit, is given by (Esarey, Schroeder, and Leemans 2009):</p>
<div class="math notranslate nohighlight">
\[v_w/c=\beta_w=\left(1-\frac{\omega_p^2}{\omega^2}\right)^{1/2}\]</div>
<p>where <span class="math notranslate nohighlight">\(\omega_p=\sqrt{(n_e e^2)/(\epsilon_0 m_e)}\)</span> is the plasma frequency, <span class="math notranslate nohighlight">\(\omega=2\pi c/\lambda\)</span> is the laser frequency, <span class="math notranslate nohighlight">\(n_e\)</span> is the plasma density, <span class="math notranslate nohighlight">\(\lambda\)</span> is the laser wavelength in vacuum, <span class="math notranslate nohighlight">\(\epsilon_0\)</span> is the permittivity of vacuum, <span class="math notranslate nohighlight">\(c\)</span> is the speed of light in vacuum, and <span class="math notranslate nohighlight">\(e\)</span> and <span class="math notranslate nohighlight">\(m_e\)</span> are respectively the charge and mass of the electron.</p>
<p>In practice, the runs are typically stopped when the last electron beam macro-particle exits the plasma, and a measure of the total time of the simulation is then given by</p>
<div class="math notranslate nohighlight">
\[T=\frac{L+\eta \lambda_p}{v_w-v_p}\]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda_p\approx 2\pi c/\omega_p\)</span> is the wake wavelength, <span class="math notranslate nohighlight">\(L\)</span> is the plasma length, <span class="math notranslate nohighlight">\(v_w\)</span> and <span class="math notranslate nohighlight">\(v_p=\beta_p c\)</span> are respectively the velocity of the wake and of the plasma relative to the frame of reference, and <span class="math notranslate nohighlight">\(\eta\)</span> is an adjustable parameter for taking into account the fraction of the wake which exited the plasma at the end of the simulation.
For a beam injected into the <span class="math notranslate nohighlight">\(n^{th}\)</span> bucket, <span class="math notranslate nohighlight">\(\eta\)</span> would be set to <span class="math notranslate nohighlight">\(n-1/2\)</span>. If positrons were considered, they would be injected half a wake period ahead of the location of the electrons injection position for a given period, and one would have <span class="math notranslate nohighlight">\(\eta=n-1\)</span>. The numerical cost <span class="math notranslate nohighlight">\(R_t\)</span> scales as the ratio of the total time to the shortest timescale of interest, which is the inverse of the laser frequency, and is thus given by</p>
<div class="math notranslate nohighlight">
\[R_t=\frac{T c}{\lambda}=\frac{\left(L+\eta \lambda_p\right)}{\left(\beta_w-\beta_p\right) \lambda}\]</div>
<p>In the laboratory, <span class="math notranslate nohighlight">\(v_p=0\)</span> and the expression simplifies to</p>
<div class="math notranslate nohighlight">
\[R_{lab}=\frac{T c}{\lambda}=\frac{\left(L+\eta \lambda_p\right)}{\beta_w \lambda}\]</div>
<p>In a frame moving at <span class="math notranslate nohighlight">\(\beta c\)</span>, the quantities become</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\lambda_p^*&amp;=&amp;\lambda_p/\left[\gamma \left(1-\beta_w \beta\right)\right] \\
L^*&amp;=&amp;L/\gamma \\
\lambda^*&amp;=&amp; \gamma\left(1+\beta\right) \lambda\\
\beta_w^*&amp;=&amp;\left(\beta_w-\beta\right)/\left(1-\beta_w\beta\right) \\
v_p^*&amp;=&amp;-\beta c \\
T^*&amp;=&amp;\frac{L^*+\eta \lambda_p^*}{v_w^*-v_p^*} \\
R_t^*&amp;=&amp;\frac{T^* c}{\lambda^*} = \frac{\left(L^*+\eta \lambda_p^*\right)}{\left(\beta_w^*+\beta\right) \lambda^*}\end{aligned}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\gamma=1/\sqrt{1-\beta^2}\)</span>.</p>
<p>The expected speedup from performing the simulation in a boosted frame is given by the ratio of <span class="math notranslate nohighlight">\(R_{lab}\)</span> and <span class="math notranslate nohighlight">\(R_t^*\)</span></p>
<div class="math notranslate nohighlight">
\[S=\frac{R_{lab}}{R_t^*}=\frac{\left(1+\beta\right)\left(L+\eta \lambda_p\right)}{\left(1-\beta\beta_w\right)L+\eta \lambda_p}
\label{Eq_scaling1d0}\]</div>
<p>We note that assuming that <span class="math notranslate nohighlight">\(\beta_w\approx1\)</span> (which is a valid approximation for most practical cases of interest) and that <span class="math notranslate nohighlight">\(\gamma&lt;&lt;\gamma_w\)</span>, this expression is consistent with the expression derived earlier (Vay 2007) for the laser-plasma acceleration case, which states that <span class="math notranslate nohighlight">\(R_t^*=\alpha R_t/\left(1+\beta\right)\)</span> with <span class="math notranslate nohighlight">\(\alpha=\left(1-\beta+l/L\right)/\left(1+l/L\right)\)</span>, where <span class="math notranslate nohighlight">\(l\)</span> is the laser length which is generally proportional to <span class="math notranslate nohighlight">\(\eta \lambda_p\)</span>, and <span class="math notranslate nohighlight">\(S=R_t/R_T^*\)</span>. However, higher values of <span class="math notranslate nohighlight">\(\gamma\)</span> are of interest for maximum speedup, as shown below.</p>
<p>For intense lasers (<span class="math notranslate nohighlight">\(a\sim 1\)</span>) typically used for acceleration, the energy gain is limited by dephasing (Schroeder et al. 2011), which occurs over a scale length <span class="math notranslate nohighlight">\(L_d \sim \lambda_p^3/2\lambda^2\)</span>.
Acceleration is compromised beyond <span class="math notranslate nohighlight">\(L_d\)</span> and in practice, the plasma length is proportional to the dephasing length, i.e. <span class="math notranslate nohighlight">\(L= \xi L_d\)</span>. In most cases, <span class="math notranslate nohighlight">\(\gamma_w^2&gt;&gt;1\)</span>, which allows the approximations <span class="math notranslate nohighlight">\(\beta_w\approx1-\lambda^2/2\lambda_p^2\)</span>, and <span class="math notranslate nohighlight">\(L=\xi \lambda_p^3/2\lambda^2\approx \xi \gamma_w^2 \lambda_p/2&gt;&gt;\eta \lambda_p\)</span>, so that Eq.(<a class="reference external" href="#Eq_scaling1d0">[Eq_scaling1d0]</a>) becomes</p>
<div class="math notranslate nohighlight">
\[S=\left(1+\beta\right)^2\gamma^2\frac{\xi\gamma_w^2}{\xi\gamma_w^2+\left(1+\beta\right)\gamma^2\left(\xi\beta/2+2\eta\right)}
\label{Eq_scaling1d}\]</div>
<p>For low values of <span class="math notranslate nohighlight">\(\gamma\)</span>, i.e. when <span class="math notranslate nohighlight">\(\gamma&lt;&lt;\gamma_w\)</span>, Eq.(<a class="reference external" href="#Eq_scaling1d">[Eq_scaling1d]</a>) reduces to</p>
<div class="math notranslate nohighlight">
\[S_{\gamma&lt;&lt;\gamma_w}=\left(1+\beta\right)^2\gamma^2
\label{Eq_scaling1d_simpl2}\]</div>
<p>Conversely, if <span class="math notranslate nohighlight">\(\gamma\rightarrow\infty\)</span>, Eq.(<a class="reference external" href="#Eq_scaling1d">[Eq_scaling1d]</a>) becomes</p>
<div class="math notranslate nohighlight">
\[S_{\gamma\rightarrow\infty}=\frac{4}{1+4\eta/\xi}\gamma_w^2
\label{Eq_scaling_gamma_inf}\]</div>
<p>Finally, in the frame of the wake, i.e. when <span class="math notranslate nohighlight">\(\gamma=\gamma_w\)</span>, assuming that <span class="math notranslate nohighlight">\(\beta_w\approx1\)</span>, Eq.(<a class="reference external" href="#Eq_scaling1d">[Eq_scaling1d]</a>) gives</p>
<div class="math notranslate nohighlight">
\[S_{\gamma=\gamma_w}\approx\frac{2}{1+2\eta/\xi}\gamma_w^2
\label{Eq_scaling_gamma_wake}\]</div>
<p>Since <span class="math notranslate nohighlight">\(\eta\)</span> and <span class="math notranslate nohighlight">\(\xi\)</span> are of order unity, and the practical regimes of most interest satisfy <span class="math notranslate nohighlight">\(\gamma_w^2&gt;&gt;1\)</span>, the speedup that is obtained by using the frame of the wake will be near the maximum obtainable value given by Eq.(<a class="reference external" href="#Eq_scaling_gamma_inf">[Eq_scaling_gamma_inf]</a>).</p>
<p>Note that without the use of a moving window, the relativistic effects that are at play in the time domain would also be at play in the spatial domain (Vay 2007), and the <span class="math notranslate nohighlight">\(\gamma^2\)</span> scaling would transform to <span class="math notranslate nohighlight">\(\gamma^4\)</span>. Hence, it is important to use a moving window even in simulations in a Lorentz boosted frame. For very high values of the boosted frame, the optimal velocity of the moving window may vanish (i.e. no moving window) or even reverse.</p>
</div>
<div class="section" id="numerical-stability-and-alternate-formulation-in-a-galilean-frame">
<h2>Numerical Stability and alternate formulation in a Galilean frame<a class="headerlink" href="#numerical-stability-and-alternate-formulation-in-a-galilean-frame" title="Permalink to this headline">¶</a></h2>
<p>The numerical Cherenkov instability (NCI) (Godfrey 1974)
is the most serious numerical instability affecting multidimensional
PIC simulations of relativistic particle beams and streaming plasmas
(Martins et al. 2010; Vay et al. 2010; J L Vay et al. 2011; Sironi and Spitkovsky 2011; Godfrey and Vay 2013; Xu et al. 2013).
It arises from coupling between possibly numerically distorted electromagnetic modes and spurious
beam modes, the latter due to the mismatch between the Lagrangian
treatment of particles and the Eulerian treatment of fields (Godfrey 1975).</p>
<p>In recent papers the electromagnetic dispersion
relations for the numerical Cherenkov instability were derived and solved for both FDTD (Godfrey and Vay 2013; Brendan B. Godfrey and Vay 2014)
and PSATD (Brendan B. Godfrey, Vay, and Haber 2014a, 2014b) algorithms.</p>
<p>Several solutions have been proposed to mitigate the NCI (Brendan B Godfrey, Vay, and Haber 2014; Brendan B. Godfrey, Vay, and Haber 2014b, 2014a; Godfrey and Vay 2015; Yu, Xu, Decyk, et al. 2015; Yu, Xu, Tableman, et al. 2015). Although
these solutions efficiently reduce the numerical instability,
they typically introduce either strong smoothing of the currents and
fields, or arbitrary numerical corrections, which are
tuned specifically against the NCI and go beyond the
natural discretization of the underlying physical equation. Therefore,
it is sometimes unclear to what extent these added corrections could impact the
physics at stake for a given resolution.</p>
<p>For instance, NCI-specific corrections include periodically smoothing
the electromagnetic field components (Martins et al. 2010),
using a special time step (Vay et al. 2010; J L Vay et al. 2011) or
applying a wide-band smoothing of the current components (Vay et al. 2010; J L Vay et al. 2011; J. Vay et al. 2011). Another set of mitigation methods
involve scaling the deposited
currents by a carefully-designed wavenumber-dependent factor
(Brendan B. Godfrey and Vay 2014; Brendan B. Godfrey, Vay, and Haber 2014b) or slightly modifying the
ratio of electric and magnetic fields (<span class="math notranslate nohighlight">\(E/B\)</span>) before gathering their
value onto the macroparticles
(Brendan B. Godfrey, Vay, and Haber 2014a; Godfrey and Vay 2015).
Yet another set of NCI-specific corrections
(Yu, Xu, Decyk, et al. 2015; Yu, Xu, Tableman, et al. 2015) consists
in combining a small timestep <span class="math notranslate nohighlight">\(\Delta t\)</span>, a sharp low-pass spatial filter,
and a spectral or high-order scheme that is tuned so as to
create a small, artificial “bump” in the dispersion relation
(Yu, Xu, Decyk, et al. 2015). While most mitigation methods have only been applied
to Cartesian geometry, this last
set of methods ((Yu, Xu, Decyk, et al. 2015; Yu, Xu, Tableman, et al. 2015))
has the remarkable property that it can be applied
(Yu, Xu, Tableman, et al. 2015) to both Cartesian geometry and
quasi-cylindrical geometry (i.e. cylindrical geometry with
azimuthal Fourier decomposition (Lifschitz et al. 2009; Davidson et al. 2015; R. Lehe et al. 2016)). However,
the use of a small timestep proportionally slows down the progress of
the simulation, and the artificial “bump” is again an arbitrary correction
that departs from the underlying physics.</p>
<p>A new scheme was recently proposed, in (Kirchen et al. 2016; Lehe et al. 2016), which
completely eliminates the NCI for a plasma drifting at a uniform relativistic velocity
– with no arbitrary correction – by simply integrating
the PIC equations in <em>Galilean coordinates</em> (also known as
<em>comoving coordinates</em>). More precisely, in the new
method, the Maxwell equations <em>in Galilean coordinates</em> are integrated
analytically, using only natural hypotheses, within the PSATD
framework (Pseudo-Spectral-Analytical-Time-Domain (Haber et al. 1973; Vay, Haber, and Godfrey 2013)).</p>
<p>The idea of the proposed scheme is to perform a Galilean change of
coordinates, and to carry out the simulation in the new coordinates:</p>
<div class="math notranslate nohighlight">
\[\label{eq:change-var}
\boldsymbol{x}' = \boldsymbol{x} - \boldsymbol{v}_{gal}t\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{x} = x\,\boldsymbol{u}_x + y\,\boldsymbol{u}_y + z\,\boldsymbol{u}_z\)</span> and
<span class="math notranslate nohighlight">\(\boldsymbol{x}' = x'\,\boldsymbol{u}_x + y'\,\boldsymbol{u}_y + z'\,\boldsymbol{u}_z\)</span> are the
position vectors in the standard and Galilean coordinates
respectively.</p>
<p>When choosing <span class="math notranslate nohighlight">\(\boldsymbol{v}_{gal}= \boldsymbol{v}_0\)</span>, where
<span class="math notranslate nohighlight">\(\boldsymbol{v}_0\)</span> is the speed of the bulk of the relativistic
plasma, the plasma does not move with respect to the grid in the Galilean
coordinates <span class="math notranslate nohighlight">\(\boldsymbol{x}'\)</span> – or, equivalently, in the standard
coordinates <span class="math notranslate nohighlight">\(\boldsymbol{x}\)</span>, the grid moves along with the plasma. The heuristic intuition behind this scheme
is that these coordinates should prevent the discrepancy between the Lagrangian and
Eulerian point of view, which gives rise to the NCI (Godfrey 1975).</p>
<p>An important remark is that the Galilean change of
coordinates (<a class="reference external" href="#eq:change-var">[eq:change-var]</a>) is a simple translation. Thus, when used in
the context of Lorentz-boosted simulations, it does
of course preserve the relativistic dilatation of space and time which gives rise to the
characteristic computational speedup of the boosted-frame technique.</p>
<p>Another important remark is that the Galilean scheme is <em>not</em>
equivalent to a moving window (and in fact the Galilean scheme can be
independently <em>combined</em> with a moving window). Whereas in a
moving window, gridpoints are added and removed so as to effectively
translate the boundaries, in the Galilean scheme the gridpoints
<em>themselves</em> are not only translated but in this case, the physical equations
are modified accordingly. Most importantly, the assumed time evolution of
the current <span class="math notranslate nohighlight">\(\boldsymbol{J}\)</span> within one timestep is different in a standard PSATD scheme with moving
window and in a Galilean PSATD scheme (Lehe et al. 2016).</p>
<p>In the Galilean coordinates <span class="math notranslate nohighlight">\(\boldsymbol{x}'\)</span>, the equations of particle
motion and the Maxwell equations take the form</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\frac{d\boldsymbol{x}'}{dt} &amp;= \frac{\boldsymbol{p}}{\gamma m} - \boldsymbol{v}_{gal}\label{eq:motion1} \\
\frac{d\boldsymbol{p}}{dt} &amp;= q \left( \boldsymbol{E} +
\frac{\boldsymbol{p}}{\gamma m} \times \boldsymbol{B} \right) \label{eq:motion2}\\
\left(  \frac{\partial \;}{\partial t} - \boldsymbol{v}_{gal}\cdot\boldsymbol{\nabla'}\right)\boldsymbol{B} &amp;= -\boldsymbol{\nabla'}\times\boldsymbol{E} \label{eq:maxwell1}\\
\frac{1}{c^2}\left(  \frac{\partial \;}{\partial t} - \boldsymbol{v}_{gal}\cdot\boldsymbol{\nabla'}\right)\boldsymbol{E} &amp;= \boldsymbol{\nabla'}\times\boldsymbol{B} - \mu_0\boldsymbol{J} \label{eq:maxwell2}\end{aligned}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{\nabla'}\)</span> denotes a spatial derivative with respect to the
Galilean coordinates <span class="math notranslate nohighlight">\(\boldsymbol{x}'\)</span>.</p>
<p>Integrating these equations from <span class="math notranslate nohighlight">\(t=n\Delta
t\)</span> to <span class="math notranslate nohighlight">\(t=(n+1)\Delta t\)</span> results in the following update equations (see
(Lehe et al. 2016) for the details of the derivation):</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\mathbf{\tilde{B}}^{n+1} &amp;= \theta^2 C \mathbf{\tilde{B}}^n
 -\frac{\theta^2 S}{ck}i\boldsymbol{k}\times \mathbf{\tilde{E}}^n \nonumber \\
&amp; + \;\frac{\theta \chi_1}{\epsilon_0c^2k^2}\;i\boldsymbol{k} \times
                     \mathbf{\tilde{J}}^{n+1/2} \label{eq:disc-maxwell1}\\
\mathbf{\tilde{E}}^{n+1} &amp;=  \theta^2 C  \mathbf{\tilde{E}}^n
 +\frac{\theta^2 S}{k} \,c i\boldsymbol{k}\times \mathbf{\tilde{B}}^n \nonumber \\
&amp; +\frac{i\nu \theta \chi_1 - \theta^2S}{\epsilon_0 ck} \; \mathbf{\tilde{J}}^{n+1/2}\nonumber \\
&amp; - \frac{1}{\epsilon_0k^2}\left(\; \chi_2\;\hat{\mathcal{\rho}}^{n+1} -
  \theta^2\chi_3\;\hat{\mathcal{\rho}}^{n} \;\right) i\boldsymbol{k} \label{eq:disc-maxwell2}\end{aligned}\end{split}\]</div>
<p>where we used the short-hand notations <span class="math notranslate nohighlight">\(\mathbf{\tilde{E}}^n \equiv
%
\mathbf{\tilde{E}}(\boldsymbol{k}, n\Delta t)\)</span>, <span class="math notranslate nohighlight">\(\mathbf{\tilde{B}}^n \equiv
\mathbf{\tilde{B}}(\boldsymbol{k}, n\Delta t)\)</span> as well as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
&amp;C = \cos(ck\Delta t) \quad S = \sin(ck\Delta t) \quad k
= |\boldsymbol{k}| \label{eq:def-C-S}\\&amp;
\nu = \frac{\boldsymbol{k}\cdot\boldsymbol{v}_{gal}}{ck} \quad \theta =
  e^{i\boldsymbol{k}\cdot\boldsymbol{v}_{gal}\Delta t/2} \quad \theta^* =
  e^{-i\boldsymbol{k}\cdot\boldsymbol{v}_{gal}\Delta t/2} \label{eq:def-nu-theta}\\&amp;
\chi_1 =  \frac{1}{1 -\nu^2} \left( \theta^* -  C \theta + i
  \nu \theta S \right) \label{eq:def-chi1}\\&amp;
\chi_2 = \frac{\chi_1 - \theta(1-C)}{\theta^*-\theta} \quad
\chi_3 = \frac{\chi_1-\theta^*(1-C)}{\theta^*-\theta} \label{eq:def-chi23}\end{aligned}\end{split}\]</div>
<p>Note that, in the limit <span class="math notranslate nohighlight">\(\boldsymbol{v}_{gal}=\boldsymbol{0}\)</span>,
(<a class="reference external" href="#eq:disc-maxwell1">[eq:disc-maxwell1]</a>) and (<a class="reference external" href="#eq:disc-maxwell2">[eq:disc-maxwell2]</a>) reduce to the standard PSATD
equations (Haber et al. 1973), as expected.
As shown in (Kirchen et al. 2016; Lehe et al. 2016),
the elimination of the NCI with the new Galilean integration is verified empirically via PIC simulations of uniform drifting plasmas and laser-driven plasma acceleration stages, and confirmed by a theoretical analysis of the instability.</p>
<div id="refs" class="references"><div id="ref-Borisjcp73"><p>Boris, Jp, and R Lee. 1973. “Nonphysical Self Forces in Some Electromagnetic Plasma-Simulation Algorithms.” Note. <em>Journal of Computational Physics</em> 12 (1). 525 B St, Ste 1900, San Diego, Ca 92101-4495: Academic Press Inc Jnl-Comp Subscriptions: 131–36.</p>
</div><div id="ref-Cowanaac08"><p>Cowan, B, D Bruhwiler, E Cormier-Michel, E Esarey, C G R Geddes, P Messmer, and K Paul. 2009. “Laser Wakefield Simulation Using A Speed-of-Light Frame Envelope Model.” In <em>Aip Conference Proceedings</em>, 1086:309–14.</p>
</div><div id="ref-DavidsonJCP2015"><p>Davidson, A., A. Tableman, W. An, F.S. Tsung, W. Lu, J. Vieira, R.A. Fonseca, L.O. Silva, and W.B. Mori. 2015. “Implementation of a hybrid particle code with a PIC description in r–z and a gridless description in ϕ into OSIRIS.” <em>Journal of Computational Physics</em> 281: 1063–77. <a class="reference external" href="https://doi.org/10.1016/j.jcp.2014.10.064">https://doi.org/10.1016/j.jcp.2014.10.064</a>.</p>
</div><div id="ref-Esareyrmp09"><p>Esarey, E, C B Schroeder, and W P Leemans. 2009. “Physics of Laser-Driven Plasma-Based Electron Accelerators.” <em>Rev. Mod. Phys.</em> 81 (3): 1229–85. <a class="reference external" href="https://doi.org/10.1103/Revmodphys.81.1229">https://doi.org/10.1103/Revmodphys.81.1229</a>.</p>
</div><div id="ref-Geddesjp08"><p>Geddes, C G R, D L Bruhwiler, J R Cary, W B Mori, J.-L. Vay, S F Martins, T Katsouleas, et al. 2008. “Computational Studies and Optimization of Wakefield Accelerators.” In <em>Journal of Physics: Conference Series</em>, 125:012002 (11 Pp.).</p>
</div><div id="ref-Geddespac09"><p>Geddes et al., C G R. 2009. “Scaled Simulation Design of High Quality Laser Wakefield Accelerator Stages.” In <em>Proc. Particle Accelerator Conference</em>. Vancouver, Canada.</p>
</div><div id="ref-Godfreyjcp74"><p>Godfrey, Bb. 1974. “Numerical Cherenkov Instabilities in Electromagnetic Particle Codes.” <em>Journal of Computational Physics</em> 15 (4): 504–21.</p>
</div><div id="ref-Godfreyjcp75"><p>———. 1975. “Canonical Momenta and Numerical Instabilities in Particle Codes.” <em>Journal of Computational Physics</em> 19 (1): 58–76.</p>
</div><div id="ref-GodfreyJCP2013"><p>Godfrey, Brendan B, and Jean-Luc Vay. 2013. “Numerical stability of relativistic beam multidimensional {PIC} simulations employing the Esirkepov algorithm.” <em>Journal of Computational Physics</em> 248 (0): 33–46. <a class="reference external" href="https://doi.org/http://dx.doi.org/10.1016/j.jcp.2013.04.006">https://doi.org/http://dx.doi.org/10.1016/j.jcp.2013.04.006</a>.</p>
</div><div id="ref-GodfreyJCP2014_FDTD"><p>Godfrey, Brendan B., and Jean Luc Vay. 2014. “Suppressing the numerical Cherenkov instability in FDTD PIC codes.” <em>Journal of Computational Physics</em> 267: 1–6.</p>
</div><div id="ref-GodfreyCPC2015"><p>———. 2015. “Improved numerical Cherenkov instability suppression in the generalized PSTD PIC algorithm.” <em>Computer Physics Communications</em> 196. Elsevier: 221–25.</p>
</div><div id="ref-GodfreyJCP2014_PSATD"><p>Godfrey, Brendan B., Jean Luc Vay, and Irving Haber. 2014a. “Numerical stability analysis of the pseudo-spectral analytical time-domain PIC algorithm.” <em>Journal of Computational Physics</em> 258: 689–704.</p>
</div><div id="ref-GodfreyIEEE2014"><p>———. 2014b. “Numerical stability improvements for the pseudospectral EM PIC algorithm.” <em>IEEE Transactions on Plasma Science</em> 42 (5). Institute of Electrical; Electronics Engineers Inc.: 1339–44.</p>
</div><div id="ref-GodfreyJCP2014"><p>Godfrey, Brendan B, Jean-Luc Vay, and Irving Haber. 2014. “Numerical stability analysis of the pseudo-spectral analytical time-domain {PIC} algorithm.” <em>Journal of Computational Physics</em> 258 (0): 689–704. <a class="reference external" href="https://doi.org/http://dx.doi.org/10.1016/j.jcp.2013.10.053">https://doi.org/http://dx.doi.org/10.1016/j.jcp.2013.10.053</a>.</p>
</div><div id="ref-Habericnsp73"><p>Haber, I, R Lee, Hh Klein, and Jp Boris. 1973. “Advances in Electromagnetic Simulation Techniques.” In <em>Proc. Sixth Conf. Num. Sim. Plasmas</em>, 46–48. Berkeley, Ca.</p>
</div><div id="ref-KirchenARXIV2016"><p>Kirchen, M., R. Lehe, B. B. Godfrey, I. Dornmair, S. Jalas, K. Peters, J.-L. Vay, and A. R. Maier. 2016. “Stable discrete representation of relativistically drifting plasmas.” <em>arXiv:1608.00215</em>.</p>
</div><div id="ref-Lehe2016"><p>Lehe, Rémi, Manuel Kirchen, Igor A. Andriyash, Brendan B. Godfrey, and Jean-Luc Vay. 2016. “A spectral, quasi-cylindrical and dispersion-free Particle-In-Cell algorithm.” <em>Computer Physics Communications</em> 203: 66–82. <a class="reference external" href="https://doi.org/10.1016/j.cpc.2016.02.007">https://doi.org/10.1016/j.cpc.2016.02.007</a>.</p>
</div><div id="ref-LeheARXIV2016"><p>Lehe, R., M. Kirchen, B. B. Godfrey, A. R. Maier, and J.-L. Vay. 2016. “Elimination of Numerical Cherenkov Instability in flowing-plasma Particle-In-Cell simulations by using Galilean coordinates.” <em>arXiv:1608.00227</em>.</p>
</div><div id="ref-LifschitzJCP2009"><p>Lifschitz, A F, X Davoine, E Lefebvre, J Faure, C Rechatin, and V Malka. 2009. “Particle-in-Cell modelling of laser{â}plasma interaction using Fourier decomposition.” <em>Journal of Computational Physics</em> 228 (5): 1803–14. <a class="reference external" href="https://doi.org/http://dx.doi.org/10.1016/j.jcp.2008.11.017">https://doi.org/http://dx.doi.org/10.1016/j.jcp.2008.11.017</a>.</p>
</div><div id="ref-Martinscpc10"><p>Martins, Samuel F, Ricardo A Fonseca, Luis O Silva, Wei Lu, and Warren B Mori. 2010. “Numerical Simulations of Laser Wakefield Accelerators in Optimal Lorentz Frames.” <em>Computer Physics Communications</em> 181 (5): 869–75. <a class="reference external" href="https://doi.org/10.1016/J.Cpc.2009.12.023">https://doi.org/10.1016/J.Cpc.2009.12.023</a>.</p>
</div><div id="ref-Schroederprl2011"><p>Schroeder, C B, C Benedetti, E Esarey, and W P Leemans. 2011. “Nonlinear Pulse Propagation and Phase Velocity of Laser-Driven Plasma Waves.” <em>Physical Review Letters</em> 106 (13): 135002. <a class="reference external" href="https://doi.org/10.1103/Physrevlett.106.135002">https://doi.org/10.1103/Physrevlett.106.135002</a>.</p>
</div><div id="ref-Spitkovsky:Icnsp2011"><p>Sironi, L, and A Spitkovsky. 2011. “No Title.”</p>
</div><div id="ref-VayJCP2013"><p>Vay, Jean Luc, Irving Haber, and Brendan B. Godfrey. 2013. “A domain decomposition method for pseudo-spectral electromagnetic simulations of plasmas.” <em>Journal of Computational Physics</em> 243: 260–68.</p>
</div><div id="ref-Vayprl07"><p>Vay, J.-L. 2007. “Noninvariance of Space- and Time-Scale Ranges Under A Lorentz Transformation and the Implications for the Study of Relativistic Interactions.” <em>Physical Review Letters</em> 98 (13): 130405/1–4.</p>
</div><div id="ref-VayAAC2010"><p>Vay, J -. L, C G R Geddes, C Benedetti, D L Bruhwiler, E Cormier-Michel, B M Cowan, J R Cary, and D P Grote. 2010. “Modeling Laser Wakefield Accelerators in A Lorentz Boosted Frame.” <em>Aip Conference Proceedings</em> 1299: 244–49. <a class="reference external" href="https://doi.org/10.1063/1.3520322">https://doi.org/10.1063/1.3520322</a>.</p>
</div><div id="ref-Vayjcp2011"><p>Vay, J L, C G R Geddes, E Cormier-Michel, and D P Grote. 2011. “Numerical Methods for Instability Mitigation in the Modeling of Laser Wakefield Accelerators in A Lorentz-Boosted Frame.” <em>Journal of Computational Physics</em> 230 (15): 5908–29. <a class="reference external" href="https://doi.org/10.1016/J.Jcp.2011.04.003">https://doi.org/10.1016/J.Jcp.2011.04.003</a>.</p>
</div><div id="ref-VayPOPL2011"><p>Vay, Jl, C G R Geddes, E Cormier-Michel, and D P Grote. 2011. “Effects of Hyperbolic Rotation in Minkowski Space on the Modeling of Plasma Accelerators in A Lorentz Boosted Frame.” <em>Physics of Plasmas</em> 18 (3): 30701. <a class="reference external" href="https://doi.org/10.1063/1.3559483">https://doi.org/10.1063/1.3559483</a>.</p>
</div><div id="ref-Vaypop2011"><p>Vay, J -L., C G R Geddes, E Esarey, C B Schroeder, W P Leemans, E Cormier-Michel, and D P Grote. 2011. “Modeling of 10 Gev-1 Tev Laser-Plasma Accelerators Using Lorentz Boosted Simulations.” <em>Physics of Plasmas</em> 18 (12). <a class="reference external" href="https://doi.org/10.1063/1.3663841">https://doi.org/10.1063/1.3663841</a>.</p>
</div><div id="ref-XuJCP2013"><p>Xu, Xinlu, Peicheng Yu, Samual F Martins, Frank S Tsung, Viktor K Decyk, Jorge Vieira, Ricardo A Fonseca, Wei Lu, Luis O Silva, and Warren B Mori. 2013. “Numerical instability due to relativistic plasma drift in EM-PIC simulations.” <em>Computer Physics Communications</em> 184 (11): 2503–14. <a class="reference external" href="https://doi.org/http://dx.doi.org/10.1016/j.cpc.2013.07.003">https://doi.org/http://dx.doi.org/10.1016/j.cpc.2013.07.003</a>.</p>
</div><div id="ref-YuCPC2015"><p>Yu, Peicheng, Xinlu Xu, Viktor K. Decyk, Frederico Fiuza, Jorge Vieira, Frank S. Tsung, Ricardo A. Fonseca, Wei Lu, Luis O. Silva, and Warren B. Mori. 2015. “Elimination of the numerical Cerenkov instability for spectral EM-PIC codes.” <em>Computer Physics Communications</em> 192 (July). ELSEVIER SCIENCE BV, PO BOX 211, 1000 AE AMSTERDAM, NETHERLANDS: 32–47. <a class="reference external" href="https://doi.org/10.1016/j.cpc.2015.02.018">https://doi.org/10.1016/j.cpc.2015.02.018</a>.</p>
</div><div id="ref-YuCPC2015-Circ"><p>Yu, Peicheng, Xinlu Xu, Adam Tableman, Viktor K. Decyk, Frank S. Tsung, Frederico Fiuza, Asher Davidson, et al. 2015. “Mitigation of numerical Cerenkov radiation and instability using a hybrid finite difference-FFT Maxwell solver and a local charge conserving current deposit.” <em>Computer Physics Communications</em> 197 (December). ELSEVIER SCIENCE BV, PO BOX 211, 1000 AE AMSTERDAM, NETHERLANDS: 144–52. <a class="reference external" href="https://doi.org/10.1016/j.cpc.2015.08.026">https://doi.org/10.1016/j.cpc.2015.08.026</a>.</p>
</div></div></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="input_output.html" class="btn btn-neutral float-right" title="Inputs and outputs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="PML.html" class="btn btn-neutral float-left" title="Boundary conditions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, WarpX collaboration

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>