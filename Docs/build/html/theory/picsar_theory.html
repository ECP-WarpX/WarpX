

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The electromagnetic Particle-In-Cell method &mdash; WarpX  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mesh refinement" href="amr.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WarpX
          

          
          </a>

          
            
            
              <div class="version">
                20.02
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../building/building.html">Building/installing WarpX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_cpp/running_cpp.html">Running WarpX as an executable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_python/running_python.html">Running WarpX from Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/visualization.html">Visualizing the simulation results</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="theory.html">Theoretical background</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The electromagnetic Particle-In-Cell method</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#particle-push">Particle push</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#boris-relativistic-velocity-rotation">Boris relativistic velocity rotation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vay-lorentz-invariant-formulation">Vay Lorentz-invariant formulation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#field-solve">Field solve</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#finite-difference-time-domain-fdtd">Finite-Difference Time-Domain (FDTD)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-standard-finite-difference-time-domain-nsfdtd">Non-Standard Finite-Difference Time-Domain (NSFDTD)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pseudo-spectral-analytical-time-domain-psatd">Pseudo Spectral Analytical Time Domain (PSATD)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#current-deposition">Current deposition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#field-gather">Field gather</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#filtering">Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="amr.html">Mesh refinement</a></li>
<li class="toctree-l2"><a class="reference internal" href="PML.html">Boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="boosted_frame.html">Moving window and optimal Lorentz boosted frame</a></li>
<li class="toctree-l2"><a class="reference internal" href="input_output.html">Inputs and outputs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developers/developers.html">Developers documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/doxygen.html">Doxygen</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WarpX</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="theory.html">Theoretical background</a> &raquo;</li>
        
      <li>The electromagnetic Particle-In-Cell method</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/theory/picsar_theory.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-electromagnetic-particle-in-cell-method">
<h1>The electromagnetic Particle-In-Cell method<a class="headerlink" href="#the-electromagnetic-particle-in-cell-method" title="Permalink to this headline">¶</a></h1>
<div class="figure align-default" id="id2">
<img alt="[fig:PIC] The Particle-In-Cell (PIC) method follows the evolution of a collection of charged macro-particles (positively charged in blue on the left plot, negatively charged in red) that evolve self-consistently with their electromagnetic (or electrostatic) fields. The core PIC algorithm involves four operations at each time step: 1) evolve the velocity and position of the particles using the Newton-Lorentz equations, 2) deposit the charge and/or current densities through interpolation from the particles distributions onto the grid, 3) evolve Maxwell’s wave equations (for electromagnetic) or solve Poisson’s equation (for electrostatic) on the grid, 4) interpolate the fields from the grid onto the particles for the next particle push. Additional “add-ons” operations are inserted between these core operations to account for additional physics (e.g. absorption/emission of particles, addition of external forces to account for accelerator focusing or accelerating component) or numerical effects (e.g. smoothing/filtering of the charge/current densities and/or fields on the grid)." src="../_images/PIC.png" />
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">[fig:PIC] The Particle-In-Cell (PIC) method follows the evolution of a collection of charged macro-particles (positively charged in blue on the left plot, negatively charged in red) that evolve self-consistently with their electromagnetic (or electrostatic) fields. The core PIC algorithm involves four operations at each time step: 1) evolve the velocity and position of the particles using the Newton-Lorentz equations, 2) deposit the charge and/or current densities through interpolation from the particles distributions onto the grid, 3) evolve Maxwell’s wave equations (for electromagnetic) or solve Poisson’s equation (for electrostatic) on the grid, 4) interpolate the fields from the grid onto the particles for the next particle push. Additional “add-ons” operations are inserted between these core operations to account for additional physics (e.g. absorption/emission of particles, addition of external forces to account for accelerator focusing or accelerating component) or numerical effects (e.g. smoothing/filtering of the charge/current densities and/or fields on the grid).</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>In the electromagnetic Particle-In-Cell method (Birdsall and Langdon 1991),
the electromagnetic fields are solved on a grid, usually using Maxwell’s
equations</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\frac{\mathbf{\partial B}}{\partial t} &amp; = &amp; -\nabla\times\mathbf{E}\label{Eq:Faraday-1}\\
\frac{\mathbf{\partial E}}{\partial t} &amp; = &amp; \nabla\times\mathbf{B}-\mathbf{J}\label{Eq:Ampere-1}\\
\nabla\cdot\mathbf{E} &amp; = &amp; \rho\label{Eq:Gauss-1}\\
\nabla\cdot\mathbf{B} &amp; = &amp; 0\label{Eq:divb-1}\end{aligned}\end{split}\]</div>
<p>given here in natural units (<span class="math notranslate nohighlight">\(\epsilon_0=\mu_0=c=1\)</span>), where <span class="math notranslate nohighlight">\(t\)</span> is time, <span class="math notranslate nohighlight">\(\mathbf{E}\)</span> and
<span class="math notranslate nohighlight">\(\mathbf{B}\)</span> are the electric and magnetic field components, and
<span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(\mathbf{J}\)</span> are the charge and current densities. The
charged particles are advanced in time using the Newton-Lorentz equations
of motion</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\frac{d\mathbf{x}}{dt}= &amp; \mathbf{v},\label{Eq:Lorentz_x-1}\\
\frac{d\left(\gamma\mathbf{v}\right)}{dt}= &amp; \frac{q}{m}\left(\mathbf{E}+\mathbf{v}\times\mathbf{B}\right),\label{Eq:Lorentz_v-1}\end{aligned}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(m\)</span>, <span class="math notranslate nohighlight">\(q\)</span>, <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{v}\)</span> and <span class="math notranslate nohighlight">\(\gamma=1/\sqrt{1-v^{2}}\)</span>
are respectively the mass, charge, position, velocity and relativistic
factor of the particle given in natural units (<span class="math notranslate nohighlight">\(c=1\)</span>). The charge and current densities are interpolated
on the grid from the particles’ positions and velocities, while the
electric and magnetic field components are interpolated from the grid
to the particles’ positions for the velocity update.</p>
<div class="section" id="particle-push">
<h2>Particle push<a class="headerlink" href="#particle-push" title="Permalink to this headline">¶</a></h2>
<p>A centered finite-difference discretization of the Newton-Lorentz
equations of motion is given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\frac{\mathbf{x}^{i+1}-\mathbf{x}^{i}}{\Delta t}= &amp; \mathbf{v}^{i+1/2},\label{Eq:leapfrog_x}\\
\frac{\gamma^{i+1/2}\mathbf{v}^{i+1/2}-\gamma^{i-1/2}\mathbf{v}^{i-1/2}}{\Delta t}= &amp; \frac{q}{m}\left(\mathbf{E}^{i}+\mathbf{\bar{v}}^{i}\times\mathbf{B}^{i}\right).\label{Eq:leapfrog_v}\end{aligned}\end{split}\]</div>
<p>In order to close the system, <span class="math notranslate nohighlight">\(\bar{\mathbf{v}}^{i}\)</span> must be
expressed as a function of the other quantities. The two implementations that have become the most popular are presented below.</p>
<div class="section" id="boris-relativistic-velocity-rotation">
<h3>Boris relativistic velocity rotation<a class="headerlink" href="#boris-relativistic-velocity-rotation" title="Permalink to this headline">¶</a></h3>
<p>The solution proposed by Boris (Boris 1970) is given by</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\mathbf{\bar{v}}^{i}= &amp; \frac{\gamma^{i+1/2}\mathbf{v}^{i+1/2}+\gamma^{i-1/2}\mathbf{v}^{i-1/2}}{2\bar{\gamma}^{i}}.\label{Eq:boris_v}\end{aligned}\]</div>
<p>where <span class="math notranslate nohighlight">\(\bar{\gamma}^{i}\)</span> is defined by <span class="math notranslate nohighlight">\(\bar{\gamma}^{i} \equiv (\gamma^{i+1/2}+\gamma^{i-1/2} )/2\)</span>.</p>
<p>The system (<a class="reference external" href="#Eq:leapfrog_v">[Eq:leapfrog_v]</a>,<a class="reference external" href="#Eq:boris_v">[Eq:boris_v]</a>) is solved very
efficiently following Boris’ method, where the electric field push
is decoupled from the magnetic push. Setting <span class="math notranslate nohighlight">\(\mathbf{u}=\gamma\mathbf{v}\)</span>, the
velocity is updated using the following sequence:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\mathbf{u^{-}}= &amp; \mathbf{u}^{i-1/2}+\left(q\Delta t/2m\right)\mathbf{E}^{i}\\
\mathbf{u'}= &amp; \mathbf{u}^{-}+\mathbf{u}^{-}\times\mathbf{t}\\
\mathbf{u}^{+}= &amp; \mathbf{u}^{-}+\mathbf{u'}\times2\mathbf{t}/(1+t^{2})\\
\mathbf{u}^{i+1/2}= &amp; \mathbf{u}^{+}+\left(q\Delta t/2m\right)\mathbf{E}^{i}\end{aligned}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{t}=\left(q\Delta t/2m\right)\mathbf{B}^{i}/\bar{\gamma}^{i}\)</span> and where
<span class="math notranslate nohighlight">\(\bar{\gamma}^{i}\)</span> can be calculated as <span class="math notranslate nohighlight">\(\bar{\gamma}^{i}=\sqrt{1+(\mathbf{u}^-/c)^2}\)</span>.</p>
<p>The Boris implementation is second-order accurate, time-reversible and fast. Its implementation is very widespread and used in the vast majority of PIC codes.</p>
</div>
<div class="section" id="vay-lorentz-invariant-formulation">
<h3>Vay Lorentz-invariant formulation<a class="headerlink" href="#vay-lorentz-invariant-formulation" title="Permalink to this headline">¶</a></h3>
<p>It was shown in (Vay 2008) that the Boris formulation is
not Lorentz invariant and can lead to significant errors in the treatment
of relativistic dynamics. A Lorentz invariant formulation is obtained
by considering the following velocity average</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\mathbf{\bar{v}}^{i}= &amp; \frac{\mathbf{v}^{i+1/2}+\mathbf{v}^{i-1/2}}{2},\label{Eq:new_v}\end{aligned}\]</div>
<p>This gives a system that is solvable analytically (see (Vay 2008)
for a detailed derivation), giving the following velocity update:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\mathbf{u^{*}}= &amp; \mathbf{u}^{i-1/2}+\frac{q\Delta t}{m}\left(\mathbf{E}^{i}+\frac{\mathbf{v}^{i-1/2}}{2}\times\mathbf{B}^{i}\right),\label{pusher_gamma}\\
\mathbf{u}^{i+1/2}= &amp; \left[\mathbf{u^{*}}+\left(\mathbf{u^{*}}\cdot\mathbf{t}\right)\mathbf{t}+\mathbf{u^{*}}\times\mathbf{t}\right]/\left(1+t^{2}\right),\label{pusher_upr}\end{aligned}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{t}=\boldsymbol{\tau}/\gamma^{i+1/2}\)</span>, <span class="math notranslate nohighlight">\(\boldsymbol{\tau}=\left(q\Delta t/2m\right)\mathbf{B}^{i}\)</span>,
<span class="math notranslate nohighlight">\(\gamma^{i+1/2}=\sqrt{\sigma+\sqrt{\sigma^{2}+\left(\tau^{2}+w^{2}\right)}}\)</span>,
<span class="math notranslate nohighlight">\(w=\mathbf{u^{*}}\cdot\boldsymbol{\tau}\)</span>, <span class="math notranslate nohighlight">\(\sigma=\left(\gamma'^{2}-\tau^{2}\right)/2\)</span>
and <span class="math notranslate nohighlight">\(\gamma'=\sqrt{1+(\mathbf{u}^{*}/c)^{2}}\)</span>. This Lorentz invariant formulation
is particularly well suited for the modeling of ultra-relativistic
charged particle beams, where the accurate account of the cancellation
of the self-generated electric and magnetic fields is essential, as
shown in (Vay 2008).</p>
</div>
</div>
<div class="section" id="field-solve">
<h2>Field solve<a class="headerlink" href="#field-solve" title="Permalink to this headline">¶</a></h2>
<p>Various methods are available for solving Maxwell’s equations on a
grid, based on finite-differences, finite-volume, finite-element,
spectral, or other discretization techniques that apply most commonly
on single structured or unstructured meshes and less commonly on multiblock
multiresolution grid structures. In this chapter, we summarize the widespread
second order finite-difference time-domain (FDTD) algorithm, its extension
to non-standard finite-differences as well as the pseudo-spectral
analytical time-domain (PSATD) and pseudo-spectral time-domain (PSTD)
algorithms. Extension to multiresolution (or mesh refinement) PIC
is described in, e.g. (Vay et al. 2012; Vay, Adam, and Heron 2004).</p>
<div class="section" id="finite-difference-time-domain-fdtd">
<h3>Finite-Difference Time-Domain (FDTD)<a class="headerlink" href="#finite-difference-time-domain-fdtd" title="Permalink to this headline">¶</a></h3>
<p>The most popular algorithm for electromagnetic PIC codes is the Finite-Difference
Time-Domain (or FDTD) solver</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
D_{t}\mathbf{B} &amp; = &amp; -\nabla\times\mathbf{E}\label{Eq:Faraday-2}\\
D_{t}\mathbf{E} &amp; = &amp; \nabla\times\mathbf{B}-\mathbf{J}\label{Eq:Ampere-2}\\
\left[\nabla\cdot\mathbf{E}\right. &amp; = &amp; \left.\rho\right]\label{Eq:Gauss-2}\\
\left[\nabla\cdot\mathbf{B}\right. &amp; = &amp; \left.0\right].\label{Eq:divb-2}\end{aligned}\end{split}\]</div>
<div class="figure align-default" id="id3">
<img alt="[fig:yee_grid](left) Layout of field components on the staggered “Yee” grid. Current densities and electric fields are defined on the edges of the cells and magnetic fields on the faces. (right) Time integration using a second-order finite-difference &quot;leapfrog&quot; integrator." src="../_images/Yee_grid.png" />
<p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">[fig:yee_grid](left) Layout of field components on the staggered “Yee” grid. Current densities and electric fields are defined on the edges of the cells and magnetic fields on the faces. (right) Time integration using a second-order finite-difference “leapfrog” integrator.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>The differential operator is defined as <span class="math notranslate nohighlight">\(\nabla=D_{x}\mathbf{\hat{x}}+D_{y}\mathbf{\hat{y}}+D_{z}\mathbf{\hat{z}}\)</span>
and the finite-difference operators in time and space are defined
respectively as</p>
<div class="math notranslate nohighlight">
\[D_{t}G|_{i,j,k}^{n}=\left(G|_{i,j,k}^{n+1/2}-G|_{i,j,k}^{n-1/2}\right)/\Delta t\]</div>
<p>and <span class="math notranslate nohighlight">\(D_{x}G|_{i,j,k}^{n}=\left(G|_{i+1/2,j,k}^{n}-G|_{i-1/2,j,k}^{n}\right)/\Delta x\)</span>,
where <span class="math notranslate nohighlight">\(\Delta t\)</span> and <span class="math notranslate nohighlight">\(\Delta x\)</span> are respectively the time step and
the grid cell size along <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(n\)</span> is the time index and <span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(j\)</span>
and <span class="math notranslate nohighlight">\(k\)</span> are the spatial indices along <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(z\)</span> respectively.
The difference operators along <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(z\)</span> are obtained by circular
permutation. The equations in brackets are given for completeness,
as they are often not actually solved, thanks to the usage of a so-called
charge conserving algorithm, as explained below. As shown in Figure
<a class="reference external" href="#fig:yee_grid">[fig:yee_grid]</a>, the quantities are given on a staggered (or “Yee”)
grid (Yee 1966), where the electric field components are located
between nodes and the magnetic field components are located in the
center of the cell faces. Knowing the current densities at half-integer steps,
the electric field components are updated alternately with the magnetic
field components at integer and half-integer steps respectively.</p>
</div>
<div class="section" id="non-standard-finite-difference-time-domain-nsfdtd">
<h3>Non-Standard Finite-Difference Time-Domain (NSFDTD)<a class="headerlink" href="#non-standard-finite-difference-time-domain-nsfdtd" title="Permalink to this headline">¶</a></h3>
<p>In (Cole 1997, 2002), Cole introduced an implementation
of the source-free Maxwell’s wave equations for narrow-band applications
based on non-standard finite-differences (NSFD). In (Karkkainen et al. 2006),
Karkkainen <em>et al.</em> adapted it for wideband applications. At
the Courant limit for the time step and for a given set of parameters,
the stencil proposed in (Karkkainen et al. 2006) has no numerical dispersion
along the principal axes, provided that the cell size is the same
along each dimension (i.e. cubic cells in 3D). The “Cole-Karkkainnen”
(or CK) solver uses the non-standard finite difference formulation
(based on extended stencils) of the Maxwell-Ampere equation and can be
implemented as follows (Vay et al. 2011):</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
D_{t}\mathbf{B} &amp; = &amp; -\nabla^{*}\times\mathbf{E}\label{Eq:Faraday}\\
D_{t}\mathbf{E} &amp; = &amp; \nabla\times\mathbf{B}-\mathbf{J}\label{Eq:Ampere}\\
\left[\nabla\cdot\mathbf{E}\right. &amp; = &amp; \left.\rho\right]\label{Eq:Gauss}\\
\left[\nabla^{*}\cdot\mathbf{B}\right. &amp; = &amp; \left.0\right]\label{Eq:divb}\end{aligned}\end{split}\]</div>
<p>Eq. <a class="reference external" href="#Eq:Gauss">[Eq:Gauss]</a> and <a class="reference external" href="#Eq:divb">[Eq:divb]</a> are not being solved explicitly
but verified via appropriate initial conditions and current deposition
procedure. The NSFD differential operators is given by <span class="math notranslate nohighlight">\(\nabla^{*}=D_{x}^{*}\mathbf{\hat{x}}+D_{y}^{*}\mathbf{\hat{y}}+D_{z}^{*}\mathbf{\hat{z}}\)</span>
where <span class="math notranslate nohighlight">\(D_{x}^{*}=\left(\alpha+\beta S_{x}^{1}+\xi S_{x}^{2}\right)D_{x}\)</span>
with <span class="math notranslate nohighlight">\(S_{x}^{1}G|_{i,j,k}^{n}=G|_{i,j+1,k}^{n}+G|_{i,j-1,k}^{n}+G|_{i,j,k+1}^{n}+G|_{i,j,k-1}^{n}\)</span>,
<span class="math notranslate nohighlight">\(S_{x}^{2}G|_{i,j,k}^{n}=G|_{i,j+1,k+1}^{n}+G|_{i,j-1,k+1}^{n}+G|_{i,j+1,k-1}^{n}+G|_{i,j-1,k-1}^{n}\)</span>.
<span class="math notranslate nohighlight">\(G\)</span> is a sample vector component, while <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span> and <span class="math notranslate nohighlight">\(\xi\)</span>
are constant scalars satisfying <span class="math notranslate nohighlight">\(\alpha+4\beta+4\xi=1\)</span>. As with
the FDTD algorithm, the quantities with half-integer are located between
the nodes (electric field components) or in the center of the cell
faces (magnetic field components). The operators along <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(z\)</span>,
i.e. <span class="math notranslate nohighlight">\(D_{y}\)</span>, <span class="math notranslate nohighlight">\(D_{z}\)</span>, <span class="math notranslate nohighlight">\(D_{y}^{*}\)</span>, <span class="math notranslate nohighlight">\(D_{z}^{*}\)</span>, <span class="math notranslate nohighlight">\(S_{y}^{1}\)</span>,
<span class="math notranslate nohighlight">\(S_{z}^{1}\)</span>, <span class="math notranslate nohighlight">\(S_{y}^{2}\)</span>, and <span class="math notranslate nohighlight">\(S_{z}^{2}\)</span>, are obtained by circular
permutation of the indices.</p>
<p>Assuming cubic cells (<span class="math notranslate nohighlight">\(\Delta x=\Delta y=\Delta z\)</span>), the coefficients
given in (Karkkainen et al. 2006) (<span class="math notranslate nohighlight">\(\alpha=7/12\)</span>, <span class="math notranslate nohighlight">\(\beta=1/12\)</span> and <span class="math notranslate nohighlight">\(\xi=1/48\)</span>)
allow for the Courant condition to be at <span class="math notranslate nohighlight">\(\Delta t=\Delta x\)</span>, which
equates to having no numerical dispersion along the principal axes.
The algorithm reduces to the FDTD algorithm with <span class="math notranslate nohighlight">\(\alpha=1\)</span> and <span class="math notranslate nohighlight">\(\beta=\xi=0\)</span>.
An extension to non-cubic cells is provided by Cowan, <em>et al.</em>
in 3-D in (Cowan et al. 2013) and was given by Pukhov in 2-D in
(Pukhov 1999). An alternative NSFDTD implementation that enables superluminous waves is also
given by Lehe et al. in (Lehe et al. 2013).</p>
<p>As mentioned above, a key feature of the algorithms based on NSFDTD
is that some implementations (Karkkainen et al. 2006; Cowan et al. 2013) enable the time step <span class="math notranslate nohighlight">\(\Delta t=\Delta x\)</span> along one or
more axes and no numerical dispersion along those axes. However, as
shown in (Vay et al. 2011), an instability develops at the Nyquist
wavelength at (or very near) such a timestep. It is also shown in
the same paper that removing the Nyquist component in all the source
terms using a bilinear filter (see description of the filter below)
suppresses this instability.</p>
</div>
<div class="section" id="pseudo-spectral-analytical-time-domain-psatd">
<h3>Pseudo Spectral Analytical Time Domain (PSATD)<a class="headerlink" href="#pseudo-spectral-analytical-time-domain-psatd" title="Permalink to this headline">¶</a></h3>
<p>Maxwell’s equations in Fourier space are given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\frac{\partial\mathbf{\tilde{E}}}{\partial t} &amp; = &amp; i\mathbf{k}\times\mathbf{\tilde{B}}-\mathbf{\tilde{J}}\\
\frac{\partial\mathbf{\tilde{B}}}{\partial t} &amp; = &amp; -i\mathbf{k}\times\mathbf{\tilde{E}}\\
{}[i\mathbf{k}\cdot\mathbf{\tilde{E}}&amp; = &amp; \tilde{\rho}]\\
{}[i\mathbf{k}\cdot\mathbf{\tilde{B}}&amp; = &amp; 0]\end{aligned}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\tilde{a}\)</span> is the Fourier Transform of the quantity <span class="math notranslate nohighlight">\(a\)</span>.
As with the real space formulation, provided that the continuity equation
<span class="math notranslate nohighlight">\(\partial\tilde{\rho}/\partial t+i\mathbf{k}\cdot\mathbf{\tilde{J}}=0\)</span> is satisfied, then
the last two equations will automatically be satisfied at any time
if satisfied initially and do not need to be explicitly integrated.</p>
<p>Decomposing the electric field and current between longitudinal and
transverse components <span class="math notranslate nohighlight">\(\mathbf{\tilde{E}}=\mathbf{\tilde{E}}_{L}+\mathbf{\tilde{E}}_{T}=\mathbf{\hat{k}}(\mathbf{\hat{k}}\cdot\mathbf{\tilde{E}})-\mathbf{\hat{k}}\times(\mathbf{\hat{k}}\times\mathbf{\tilde{E}})\)</span>
and <span class="math notranslate nohighlight">\(\mathbf{\tilde{J}}=\mathbf{\tilde{J}}_{L}+\mathbf{\tilde{J}}_{T}=\mathbf{\hat{k}}(\mathbf{\hat{k}}\cdot\mathbf{\tilde{J}})-\mathbf{\hat{k}}\times(\mathbf{\hat{k}}\times\mathbf{\tilde{J}})\)</span>
gives</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\frac{\partial\mathbf{\tilde{E}}_{T}}{\partial t} &amp; = &amp; i\mathbf{k}\times\mathbf{\tilde{B}}-\mathbf{\tilde{J}_{T}}\\
\frac{\partial\mathbf{\tilde{E}}_{L}}{\partial t} &amp; = &amp; -\mathbf{\tilde{J}_{L}}\\
\frac{\partial\mathbf{\tilde{B}}}{\partial t} &amp; = &amp; -i\mathbf{k}\times\mathbf{\tilde{E}}\end{aligned}\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\(\mathbf{\hat{k}}=\mathbf{k}/k\)</span>.</p>
<p>If the sources are assumed to be constant over a time interval <span class="math notranslate nohighlight">\(\Delta t\)</span>,
the system of equations is solvable analytically and is given by (see
(Haber et al. 1973) for the original formulation and (Jean-Luc Vay, Haber, and Godfrey 2013)
for a more detailed derivation):</p>
<p>[Eq:PSATD]</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\mathbf{\tilde{E}}_{T}^{n+1} &amp; = &amp; C\mathbf{\tilde{E}}_{T}^{n}+iS\mathbf{\hat{k}}\times\mathbf{\tilde{B}}^{n}-\frac{S}{k}\mathbf{\tilde{J}}_{T}^{n+1/2}\label{Eq:PSATD_transverse_1}\\
\mathbf{\tilde{E}}_{L}^{n+1} &amp; = &amp; \mathbf{\tilde{E}}_{L}^{n}-\Delta t\mathbf{\tilde{J}}_{L}^{n+1/2}\\
\mathbf{\tilde{B}}^{n+1} &amp; = &amp; C\mathbf{\tilde{B}}^{n}-iS\mathbf{\hat{k}}\times\mathbf{\tilde{E}}^{n}\\
&amp;+&amp;i\frac{1-C}{k}\mathbf{\hat{k}}\times\mathbf{\tilde{J}}^{n+1/2}\label{Eq:PSATD_transverse_2}\end{aligned}\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\(C=\cos\left(k\Delta t\right)\)</span> and <span class="math notranslate nohighlight">\(S=\sin\left(k\Delta t\right)\)</span>.</p>
<p>Combining the transverse and longitudinal components, gives</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\mathbf{\tilde{E}}^{n+1} &amp; = &amp; C\mathbf{\tilde{E}}^{n}+iS\mathbf{\hat{k}}\times\mathbf{\tilde{B}}^{n}-\frac{S}{k}\mathbf{\tilde{J}}^{n+1/2}\\
 &amp; + &amp;(1-C)\mathbf{\hat{k}}(\mathbf{\hat{k}}\cdot\mathbf{\tilde{E}}^{n})\nonumber \\
 &amp; + &amp; \mathbf{\hat{k}}(\mathbf{\hat{k}}\cdot\mathbf{\tilde{J}}^{n+1/2})\left(\frac{S}{k}-\Delta t\right),\label{Eq_PSATD_1}\\
\mathbf{\tilde{B}}^{n+1} &amp; = &amp; C\mathbf{\tilde{B}}^{n}-iS\mathbf{\hat{k}}\times\mathbf{\tilde{E}}^{n}\\
&amp;+&amp;i\frac{1-C}{k}\mathbf{\hat{k}}\times\mathbf{\tilde{J}}^{n+1/2}.\label{Eq_PSATD_2}\end{aligned}\end{split}\]</div>
<p>For fields generated by the source terms without the self-consistent
dynamics of the charged particles, this algorithm is free of numerical
dispersion and is not subject to a Courant condition. Furthermore,
this solution is exact for any time step size subject to the assumption
that the current source is constant over that time step.</p>
<p>As shown in (Jean-Luc Vay, Haber, and Godfrey 2013), by expanding the coefficients <span class="math notranslate nohighlight">\(S_{h}\)</span>
and <span class="math notranslate nohighlight">\(C_{h}\)</span> in Taylor series and keeping the leading terms, the PSATD
formulation reduces to the perhaps better known pseudo-spectral time-domain
(PSTD) formulation (Dawson 1983; Liu 1997):</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\mathbf{\tilde{E}}^{n+1} &amp; = &amp; \mathbf{\tilde{E}}^{n}+i\Delta t\mathbf{k}\times\mathbf{\tilde{B}}^{n+1/2}-\Delta t\mathbf{\tilde{J}}^{n+1/2},\\
\mathbf{\tilde{B}}^{n+3/2} &amp; = &amp; \mathbf{\tilde{B}}^{n+1/2}-i\Delta t\mathbf{k}\times\mathbf{\tilde{E}}^{n+1}.\end{aligned}\end{split}\]</div>
<p>The dispersion relation of the PSTD solver is given by <span class="math notranslate nohighlight">\(\sin(\frac{\omega\Delta t}{2})=\frac{k\Delta t}{2}.\)</span>
In contrast to the PSATD solver, the PSTD solver is subject to numerical
dispersion for a finite time step and to a Courant condition that
is given by <span class="math notranslate nohighlight">\(\Delta t\leq \frac{2}{\pi}\left(\frac{1}{\Delta x^{2}}+\frac{1}{\Delta y^{2}}+\frac{1}{\Delta x^{2}}\right)^{-1/2}.\)</span></p>
<p>The PSATD and PSTD formulations that were just given apply to the
field components located at the nodes of the grid. As noted in (Ohmura and Okamura 2010),
they can also be easily recast on a staggered Yee grid by multiplication
of the field components by the appropriate phase factors to shift
them from the collocated to the staggered locations. The choice between
a collocated and a staggered formulation is application-dependent.</p>
<p>Spectral solvers used to be very popular in the years 1970s to early 1990s, before being replaced by finite-difference methods with the advent of parallel supercomputers that favored local methods. However, it was shown recently that standard domain decomposition with Fast Fourier Transforms that are local to each subdomain could be used effectively with PIC spectral methods (Jean-Luc Vay, Haber, and Godfrey 2013), at the cost of truncation errors in the guard cells that could be neglected. A detailed analysis of the effectiveness of the method with exact evaluation of the magnitude of the effect of the truncation error is given in (Vincenti and Vay 2016) for stencils of arbitrary order (up-to the infinite “spectral” order).</p>
</div>
</div>
<div class="section" id="current-deposition">
<span id="id1"></span><h2>Current deposition<a class="headerlink" href="#current-deposition" title="Permalink to this headline">¶</a></h2>
<p>The current densities are deposited on the computational grid from
the particle position and velocities, employing splines of various
orders (Abe et al. 1986).</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\rho &amp; = &amp; \frac{1}{\Delta x \Delta y \Delta z}\sum_nq_nS_n\\
\mathbf{J} &amp; = &amp; \frac{1}{\Delta x \Delta y \Delta z}\sum_nq_n\mathbf{v_n}S_n\end{aligned}\end{split}\]</div>
<p>In most applications, it is essential to prevent the accumulation
of errors resulting from the violation of the discretized Gauss’ Law.
This is accomplished by providing a method for depositing the current
from the particles to the grid that preserves the discretized Gauss’
Law, or by providing a mechanism for “divergence cleaning” (Birdsall and Langdon 1991; Langdon 1992; Marder 1987; Vay and Deutsch 1998; Munz et al. 2000).
For the former, schemes that allow a deposition of the current that
is exact when combined with the Yee solver is given in (Villasenor and Buneman 1992)
for linear splines and in (Esirkepov 2001) for splines of arbitrary order.</p>
<p>The NSFDTD formulations given above and in (Pukhov 1999; Vay et al. 2011; Cowan et al. 2013; Lehe et al. 2013)
apply to the Maxwell-Faraday
equation, while the discretized Maxwell-Ampere equation uses the FDTD
formulation. Consequently, the charge conserving algorithms developed
for current deposition (Villasenor and Buneman 1992; Esirkepov 2001) apply
readily to those NSFDTD-based formulations. More details concerning
those implementations, including the expressions for the numerical
dispersion and Courant condition are given
in (Pukhov 1999; Vay et al. 2011; Cowan et al. 2013; Lehe et al. 2013).</p>
<p>In the case of the pseudospectral solvers, the current deposition
algorithm generally does not satisfy the discretized continuity equation
in Fourier space <span class="math notranslate nohighlight">\(\tilde{\rho}^{n+1}=\tilde{\rho}^{n}-i\Delta t\mathbf{k}\cdot\mathbf{\tilde{J}}^{n+1/2}\)</span>.
In this case, a Boris correction (Birdsall and Langdon 1991) can be applied
in <span class="math notranslate nohighlight">\(k\)</span> space in the form <span class="math notranslate nohighlight">\(\mathbf{\tilde{E}}_{c}^{n+1}=\mathbf{\tilde{E}}^{n+1}-\left(\mathbf{k}\cdot\mathbf{\tilde{E}}^{n+1}+i\tilde{\rho}^{n+1}\right)\mathbf{\hat{k}}/k\)</span>,
where <span class="math notranslate nohighlight">\(\mathbf{\tilde{E}}_{c}\)</span> is the corrected field. Alternatively, a correction
to the current can be applied (with some similarity to the current
deposition presented by Morse and Nielson in their potential-based
model in (Morse and Nielson 1971)) using <span class="math notranslate nohighlight">\(\mathbf{\tilde{J}}_{c}^{n+1/2}=\mathbf{\tilde{J}}^{n+1/2}-\left[\mathbf{k}\cdot\mathbf{\tilde{J}}^{n+1/2}-i\left(\tilde{\rho}^{n+1}-\tilde{\rho}^{n}\right)/\Delta t\right]\mathbf{\hat{k}}/k\)</span>,
where <span class="math notranslate nohighlight">\(\mathbf{\tilde{J}}_{c}\)</span> is the corrected current. In this case, the transverse
component of the current is left untouched while the longitudinal
component is effectively replaced by the one obtained from integration
of the continuity equation, ensuring that the corrected current satisfies
the continuity equation. The advantage of correcting the current rather than
the electric field is that it is more local and thus more compatible with
domain decomposition of the fields for parallel computation (Jean Luc Vay, Haber, and Godfrey 2013).</p>
<p>Alternatively, an exact current deposition can be written for the pseudospectral solvers, following the geometrical interpretation of existing methods in real space (Morse and Nielson 1971; Villasenor and Buneman 1992; Esirkepov 2001), thereby averaging the currents of the paths following grid lines between positions <span class="math notranslate nohighlight">\((x^n,y^n)\)</span> and <span class="math notranslate nohighlight">\((x^{n+1},y^{n+1})\)</span>, which is given in 2D (extension to 3D follows readily) for <span class="math notranslate nohighlight">\(k\neq0\)</span> by (Jean Luc Vay, Haber, and Godfrey 2013):</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\mathbf{\tilde{J}}^{k\neq0}=\frac{i\mathbf{\tilde{D}}}{\mathbf{k}}\end{aligned}\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
D_x   =  \frac{1}{2\Delta t}\sum_i q_i
  [\Gamma(x_i^{n+1},y_i^{n+1})-\Gamma(x_i^{n},y_i^{n+1}) \nonumber\\
+\Gamma(x_i^{n+1},y_i^{n})-\Gamma(x_i^{n},y_i^{n})],\\
D_y   =  \frac{1}{2\Delta t}\sum_i q_i
  [\Gamma(x_i^{n+1},y_i^{n+1})-\Gamma(x_i^{n+1},y_i^{n}) \nonumber \\
+\Gamma(x_i^{n},y_i^{n+1})-\Gamma(x_i^{n},y_i^{n})],\end{aligned}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\Gamma\)</span> is the macro-particle form factor.
The contributions for <span class="math notranslate nohighlight">\(k=0\)</span> are integrated directly in real space (Jean Luc Vay, Haber, and Godfrey 2013).</p>
</div>
<div class="section" id="field-gather">
<h2>Field gather<a class="headerlink" href="#field-gather" title="Permalink to this headline">¶</a></h2>
<p>The current densities are deposited on the computational grid from
the particle position and velocities, employing splines of various
orders (Abe et al. 1986).</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\rho &amp; = &amp; \frac{1}{\Delta x \Delta y \Delta z}\sum_nq_nS_n\\
\mathbf{J} &amp; = &amp; \frac{1}{\Delta x \Delta y \Delta z}\sum_nq_n\mathbf{v_n}S_n\end{aligned}\end{split}\]</div>
<p>In most applications, it is essential to prevent the accumulation
of errors resulting from the violation of the discretized Gauss’ Law.
This is accomplished by providing a method for depositing the current
from the particles to the grid that preserves the discretized Gauss’
Law, or by providing a mechanism for “divergence cleaning” (Birdsall and Langdon 1991; Langdon 1992; Marder 1987; Vay and Deutsch 1998; Munz et al. 2000).
For the former, schemes that allow a deposition of the current that
is exact when combined with the Yee solver is given in (Villasenor and Buneman 1992)
for linear splines and in (Esirkepov 2001) for splines of arbitrary order.</p>
<p>The NSFDTD formulations given above and in (Pukhov 1999; Vay et al. 2011; Cowan et al. 2013; Lehe et al. 2013)
apply to the Maxwell-Faraday
equation, while the discretized Maxwell-Ampere equation uses the FDTD
formulation. Consequently, the charge conserving algorithms developed
for current deposition (Villasenor and Buneman 1992; Esirkepov 2001) apply
readily to those NSFDTD-based formulations. More details concerning
those implementations, including the expressions for the numerical
dispersion and Courant condition are given
in (Pukhov 1999; Vay et al. 2011; Cowan et al. 2013; Lehe et al. 2013).</p>
<p>In the case of the pseudospectral solvers, the current deposition
algorithm generally does not satisfy the discretized continuity equation
in Fourier space <span class="math notranslate nohighlight">\(\tilde{\rho}^{n+1}=\tilde{\rho}^{n}-i\Delta t\mathbf{k}\cdot\mathbf{\tilde{J}}^{n+1/2}\)</span>.
In this case, a Boris correction (Birdsall and Langdon 1991) can be applied
in <span class="math notranslate nohighlight">\(k\)</span> space in the form <span class="math notranslate nohighlight">\(\mathbf{\tilde{E}}_{c}^{n+1}=\mathbf{\tilde{E}}^{n+1}-\left(\mathbf{k}\cdot\mathbf{\tilde{E}}^{n+1}+i\tilde{\rho}^{n+1}\right)\mathbf{\hat{k}}/k\)</span>,
where <span class="math notranslate nohighlight">\(\mathbf{\tilde{E}}_{c}\)</span> is the corrected field. Alternatively, a correction
to the current can be applied (with some similarity to the current
deposition presented by Morse and Nielson in their potential-based
model in (Morse and Nielson 1971)) using <span class="math notranslate nohighlight">\(\mathbf{\tilde{J}}_{c}^{n+1/2}=\mathbf{\tilde{J}}^{n+1/2}-\left[\mathbf{k}\cdot\mathbf{\tilde{J}}^{n+1/2}-i\left(\tilde{\rho}^{n+1}-\tilde{\rho}^{n}\right)/\Delta t\right]\mathbf{\hat{k}}/k\)</span>,
where <span class="math notranslate nohighlight">\(\mathbf{\tilde{J}}_{c}\)</span> is the corrected current. In this case, the transverse
component of the current is left untouched while the longitudinal
component is effectively replaced by the one obtained from integration
of the continuity equation, ensuring that the corrected current satisfies
the continuity equation. The advantage of correcting the current rather than
the electric field is that it is more local and thus more compatible with
domain decomposition of the fields for parallel computation (Jean Luc Vay, Haber, and Godfrey 2013).</p>
<p>Alternatively, an exact current deposition can be written for the pseudospectral solvers, following the geometrical interpretation of existing methods in real space (Morse and Nielson 1971; Villasenor and Buneman 1992; Esirkepov 2001), thereby averaging the currents of the paths following grid lines between positions <span class="math notranslate nohighlight">\((x^n,y^n)\)</span> and <span class="math notranslate nohighlight">\((x^{n+1},y^{n+1})\)</span>, which is given in 2D (extension to 3D follows readily) for <span class="math notranslate nohighlight">\(k\neq0\)</span> by (Jean Luc Vay, Haber, and Godfrey 2013):</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\mathbf{\tilde{J}}^{k\neq0}=\frac{i\mathbf{\tilde{D}}}{\mathbf{k}}
\label{Eq_Jdep_1}\end{aligned}\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
D_x   =  \frac{1}{2\Delta t}\sum_i q_i
  [\Gamma(x_i^{n+1},y_i^{n+1})-\Gamma(x_i^{n},y_i^{n+1}) \nonumber\\
+\Gamma(x_i^{n+1},y_i^{n})-\Gamma(x_i^{n},y_i^{n})],\\
D_y   =  \frac{1}{2\Delta t}\sum_i q_i
  [\Gamma(x_i^{n+1},y_i^{n+1})-\Gamma(x_i^{n+1},y_i^{n}) \nonumber \\
+\Gamma(x_i^{n},y_i^{n+1})-\Gamma(x_i^{n},y_i^{n})],\end{aligned}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\Gamma\)</span> is the macro-particle form factor.
The contributions for <span class="math notranslate nohighlight">\(k=0\)</span> are integrated directly in real space (Jean Luc Vay, Haber, and Godfrey 2013).</p>
</div>
</div>
<div class="section" id="filtering">
<h1>Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h1>
<p>It is common practice to apply digital filtering to the charge or
current density in Particle-In-Cell simulations as a complement or
an alternative to using higher order splines (Birdsall and Langdon 1991).
A commonly used filter in PIC simulations is the three points filter
<span class="math notranslate nohighlight">\(\phi_{j}^{f}=\alpha\phi_{j}+\left(1-\alpha\right)\left(\phi_{j-1}+\phi_{j+1}\right)/2\)</span>
where <span class="math notranslate nohighlight">\(\phi^{f}\)</span> is the filtered quantity. This filter is called
a bilinear filter when <span class="math notranslate nohighlight">\(\alpha=0.5\)</span>. Assuming <span class="math notranslate nohighlight">\(\phi=e^{jkx}\)</span> and
<span class="math notranslate nohighlight">\(\phi^{f}=g\left(\alpha,k\right)e^{jkx}\)</span>, the filter gain <span class="math notranslate nohighlight">\(g\)</span> is
given as a function of the filtering coefficient <span class="math notranslate nohighlight">\(\alpha\)</span> and
the wavenumber <span class="math notranslate nohighlight">\(k\)</span> by <span class="math notranslate nohighlight">\(g\left(\alpha,k\right)=\alpha+\left(1-\alpha\right)\cos\left(k\Delta x\right)\approx1-\left(1-\alpha\right)\frac{\left(k\Delta x\right)^{2}}{2}+O\left(k^{4}\right)\)</span>.
The total attenuation <span class="math notranslate nohighlight">\(G\)</span> for <span class="math notranslate nohighlight">\(n\)</span> successive applications of filters
of coefficients <span class="math notranslate nohighlight">\(\alpha_{1}\)</span>…<span class="math notranslate nohighlight">\(\alpha_{n}\)</span> is given by <span class="math notranslate nohighlight">\(G=\prod_{i=1}^{n}g\left(\alpha_{i},k\right)\approx1-\left(n-\sum_{i=1}^{n}\alpha_{i}\right)\frac{\left(k\Delta x\right)^{2}}{2}+O\left(k^{4}\right)\)</span>.
A sharper cutoff in <span class="math notranslate nohighlight">\(k\)</span> space is provided by using <span class="math notranslate nohighlight">\(\alpha_{n}=n-\sum_{i=1}^{n-1}\alpha_{i}\)</span>,
so that <span class="math notranslate nohighlight">\(G\approx1+O\left(k^{4}\right)\)</span>. Such step is called a “compensation”
step (Birdsall and Langdon 1991). For the bilinear filter (<span class="math notranslate nohighlight">\(\alpha=1/2\)</span>),
the compensation factor is <span class="math notranslate nohighlight">\(\alpha_{c}=2-1/2=3/2\)</span>. For a succession
of <span class="math notranslate nohighlight">\(n\)</span> applications of the bilinear factor, it is <span class="math notranslate nohighlight">\(\alpha_{c}=n/2+1\)</span>.</p>
<p>It is sometimes necessary to filter on a relatively wide band of wavelength,
necessitating the application of a large number of passes of the bilinear
filter or on the use of filters acting on many points. The former
can become very intensive computationally while the latter is problematic
for parallel computations using domain decomposition, as the footprint
of the filter may eventually surpass the size of subdomains. A workaround
is to use a combination of filters of limited footprint. A solution
based on the combination of three point filters with various strides
was proposed in (Vay et al. 2011) and operates as follows.</p>
<p>The bilinear filter provides complete suppression of the signal at
the grid Nyquist wavelength (twice the grid cell size). Suppression
of the signal at integer multiples of the Nyquist wavelength can be
obtained by using a stride <span class="math notranslate nohighlight">\(s\)</span> in the filter <span class="math notranslate nohighlight">\(\phi_{j}^{f}=\alpha\phi_{j}+\left(1-\alpha\right)\left(\phi_{j-s}+\phi_{j+s}\right)/2\)</span>
for which the gain is given by <span class="math notranslate nohighlight">\(g\left(\alpha,k\right)=\alpha+\left(1-\alpha\right)\cos\left(sk\Delta x\right)\approx1-\left(1-\alpha\right)\frac{\left(sk\Delta x\right)^{2}}{2}+O\left(k^{4}\right)\)</span>.
For a given stride, the gain is given by the gain of the bilinear
filter shifted in k space, with the pole <span class="math notranslate nohighlight">\(g=0\)</span> shifted from the wavelength
<span class="math notranslate nohighlight">\(\lambda=2/\Delta x\)</span> to <span class="math notranslate nohighlight">\(\lambda=2s/\Delta x\)</span>, with additional poles,
as given by <span class="math notranslate nohighlight">\(sk\Delta x=\arccos\left(\frac{\alpha}{\alpha-1}\right)\pmod{2\pi}\)</span>.
The resulting filter is pass band between the poles, but since the
poles are spread at different integer values in k space, a wide band
low pass filter can be constructed by combining filters using different
strides. As shown in (Vay et al. 2011), the successive application
of 4-passes + compensation of filters with strides 1, 2 and 4 has
a nearly equivalent fall-off in gain as 80 passes + compensation of
a bilinear filter. Yet, the strided filter solution needs only 15
passes of a three-point filter, compared to 81 passes for an equivalent
n-pass bilinear filter, yielding a gain of 5.4 in number of operations
in favor of the combination of filters with stride. The width of the
filter with stride 4 extends only on 9 points, compared to 81 points
for a single pass equivalent filter, hence giving a gain of 9 in compactness
for the stride filters combination in comparison to the single-pass
filter with large stencil, resulting in more favorable scaling with the number
of computational cores for parallel calculations.</p>
<div id="refs" class="references"><div id="ref-Abejcp86"><p>Abe, H, N Sakairi, R Itatani, and H Okuda. 1986. “High-Order Spline Interpolations in the Particle Simulation.” <em>Journal of Computational Physics</em> 63 (2): 247–67.</p>
</div><div id="ref-Birdsalllangdon"><p>Birdsall, C K, and A B Langdon. 1991. <em>Plasma Physics via Computer Simulation</em>. Adam-Hilger.</p>
</div><div id="ref-BorisICNSP70"><p>Boris, Jp. 1970. “Relativistic Plasma Simulation-Optimization of a Hybrid Code.” In <em>Proc. Fourth Conf. Num. Sim. Plasmas</em>, 3–67. Naval Res. Lab., Wash., D. C.</p>
</div><div id="ref-Coleieee1997"><p>Cole, J. B. 1997. “A High-Accuracy Realization of the Yee Algorithm Using Non-Standard Finite Differences.” <em>Ieee Transactions on Microwave Theory and Techniques</em> 45 (6): 991–96.</p>
</div><div id="ref-Coleieee2002"><p>———. 2002. “High-Accuracy Yee Algorithm Based on Nonstandard Finite Differences: New Developments and Verifications.” <em>Ieee Transactions on Antennas and Propagation</em> 50 (9): 1185–91. <a class="reference external" href="https://doi.org/10.1109/Tap.2002.801268">https://doi.org/10.1109/Tap.2002.801268</a>.</p>
</div><div id="ref-CowanPRSTAB13"><p>Cowan, Benjamin M, David L Bruhwiler, John R Cary, Estelle Cormier-Michel, and Cameron G R Geddes. 2013. “Generalized algorithm for control of numerical dispersion in explicit time-domain electromagnetic simulations.” <em>Physical Review Special Topics-Accelerators and Beams</em> 16 (4). <a class="reference external" href="https://doi.org/10.1103/PhysRevSTAB.16.041303">https://doi.org/10.1103/PhysRevSTAB.16.041303</a>.</p>
</div><div id="ref-DawsonRMP83"><p>Dawson, J M. 1983. “Particle Simulation of Plasmas.” <em>Reviews of Modern Physics</em> 55 (2): 403–47. <a class="reference external" href="https://doi.org/10.1103/RevModPhys.55.403">https://doi.org/10.1103/RevModPhys.55.403</a>.</p>
</div><div id="ref-Esirkepovcpc01"><p>Esirkepov, Tz. 2001. “Exact Charge Conservation Scheme for Particle-in-Cell Simulation with an Arbitrary Form-Factor.” <em>Computer Physics Communications</em> 135 (2): 144–53.</p>
</div><div id="ref-Habericnsp73"><p>Haber, I, R Lee, Hh Klein, and Jp Boris. 1973. “Advances in Electromagnetic Simulation Techniques.” In <em>Proc. Sixth Conf. Num. Sim. Plasmas</em>, 46–48. Berkeley, Ca.</p>
</div><div id="ref-Karkicap06"><p>Karkkainen, M, E Gjonaj, T Lau, and T Weiland. 2006. “Low-Dispersionwake Field Calculation Tools.” In <em>Proc. Of International Computational Accelerator Physics Conference</em>, 35–40. Chamonix, France.</p>
</div><div id="ref-Langdoncpc92"><p>Langdon, A B. 1992. “On Enforcing Gauss Law in Electromagnetic Particle-in-Cell Codes.” <em>Computer Physics Communications</em> 70 (3): 447–50.</p>
</div><div id="ref-LehePRSTAB13"><p>Lehe, R, A Lifschitz, C Thaury, V Malka, and X Davoine. 2013. “Numerical growth of emittance in simulations of laser-wakefield acceleration.” <em>Physical Review Special Topics-Accelerators and Beams</em> 16 (2). <a class="reference external" href="https://doi.org/10.1103/PhysRevSTAB.16.021301">https://doi.org/10.1103/PhysRevSTAB.16.021301</a>.</p>
</div><div id="ref-Liumotl1997"><p>Liu, Qh. 1997. “The PSTD Algorithm: A Time-Domain Method Requiring Only Two Cells Per Wavelength.” <em>Microwave and Optical Technology Letters</em> 15 (3): 158–65. <a class="reference external" href="https://doi.org/10.1002/(SICI)1098-2760(19970620)15:3&lt;158::AID-MOP11&gt;3.0.CO;2-3">https://doi.org/10.1002/(SICI)1098-2760(19970620)15:3&lt;158::AID-MOP11&gt;3.0.CO;2-3</a>.</p>
</div><div id="ref-Marderjcp87"><p>Marder, B. 1987. “A Method for Incorporating Gauss Law into Electromagnetic Pic Codes.” <em>Journal of Computational Physics</em> 68 (1): 48–55.</p>
</div><div id="ref-Morsenielson1971"><p>Morse, Rl, and Cw Nielson. 1971. “Numerical Simulation of Weibel Instability in One and 2 Dimensions.” <em>Phys. Fluids</em> 14 (4): 830 –&amp;. <a class="reference external" href="https://doi.org/10.1063/1.1693518">https://doi.org/10.1063/1.1693518</a>.</p>
</div><div id="ref-Munzjcp2000"><p>Munz, Cd, P Omnes, R Schneider, E Sonnendrucker, and U Voss. 2000. “Divergence Correction Techniques for Maxwell Solvers Based on A Hyperbolic Model.” <em>Journal of Computational Physics</em> 161 (2): 484–511. <a class="reference external" href="https://doi.org/10.1006/Jcph.2000.6507">https://doi.org/10.1006/Jcph.2000.6507</a>.</p>
</div><div id="ref-Ohmurapiers2010"><p>Ohmura, Y, and Y Okamura. 2010. “Staggered Grid Pseudo-Spectral Time-Domain Method for Light Scattering Analysis.” <em>Piers Online</em> 6 (7): 632–35.</p>
</div><div id="ref-PukhovJPP99"><p>Pukhov, A. 1999. “Three-dimensional electromagnetic relativistic particle-in-cell code VLPL (Virtual Laser Plasma Lab).” <em>Journal of Plasma Physics</em> 61 (3): 425–33. <a class="reference external" href="https://doi.org/10.1017/S0022377899007515">https://doi.org/10.1017/S0022377899007515</a>.</p>
</div><div id="ref-VayJCP13"><p>Vay, Jean-Luc, Irving Haber, and Brendan B Godfrey. 2013. “A domain decomposition method for pseudo-spectral electromagnetic simulations of plasmas.” <em>Journal of Computational Physics</em> 243 (June): 260–68. <a class="reference external" href="https://doi.org/10.1016/j.jcp.2013.03.010">https://doi.org/10.1016/j.jcp.2013.03.010</a>.</p>
</div><div id="ref-VayJCP2013"><p>Vay, Jean Luc, Irving Haber, and Brendan B. Godfrey. 2013. “A domain decomposition method for pseudo-spectral electromagnetic simulations of plasmas.” <em>Journal of Computational Physics</em> 243: 260–68.</p>
</div><div id="ref-Vaypop2008"><p>Vay, J L. 2008. “Simulation of Beams or Plasmas Crossing at Relativistic Velocity.” <em>Physics of Plasmas</em> 15 (5): 56701. <a class="reference external" href="https://doi.org/10.1063/1.2837054">https://doi.org/10.1063/1.2837054</a>.</p>
</div><div id="ref-Vaycpc04"><p>Vay, J.-L., J.-C. Adam, and A Heron. 2004. “Asymmetric Pml for the Absorption of Waves. Application to Mesh Refinement in Electromagnetic Particle-in-Cell Plasma Simulations.” <em>Computer Physics Communications</em> 164 (1-3): 171–77. <a class="reference external" href="https://doi.org/10.1016/J.Cpc.2004.06.026">https://doi.org/10.1016/J.Cpc.2004.06.026</a>.</p>
</div><div id="ref-Vaypop98"><p>Vay, J.-L., and C Deutsch. 1998. “Charge Compensated Ion Beam Propagation in A Reactor Sized Chamber.” <em>Physics of Plasmas</em> 5 (4): 1190–7.</p>
</div><div id="ref-Vayjcp2011"><p>Vay, J L, C G R Geddes, E Cormier-Michel, and D P Grote. 2011. “Numerical Methods for Instability Mitigation in the Modeling of Laser Wakefield Accelerators in A Lorentz-Boosted Frame.” <em>Journal of Computational Physics</em> 230 (15): 5908–29. <a class="reference external" href="https://doi.org/10.1016/J.Jcp.2011.04.003">https://doi.org/10.1016/J.Jcp.2011.04.003</a>.</p>
</div><div id="ref-VayCSD12"><p>Vay, J.-L., D P Grote, R H Cohen, and A Friedman. 2012. “Novel methods in the particle-in-cell accelerator code-framework warp.” Journal Paper. <em>Computational Science and Discovery</em> 5 (1): 014019 (20 pp.).</p>
</div><div id="ref-Villasenorcpc92"><p>Villasenor, J, and O Buneman. 1992. “Rigorous Charge Conservation for Local Electromagnetic-Field Solvers.” <em>Computer Physics Communications</em> 69 (2-3): 306–16.</p>
</div><div id="ref-Vincenti2016a"><p>Vincenti, H., and J.-L. Vay. 2016. “Detailed analysis of the effects of stencil spatial variations with arbitrary high-order finite-difference Maxwell solver.” <em>Computer Physics Communications</em> 200 (March). ELSEVIER SCIENCE BV, PO BOX 211, 1000 AE AMSTERDAM, NETHERLANDS: 147–67. <a class="reference external" href="https://doi.org/10.1016/j.cpc.2015.11.009">https://doi.org/10.1016/j.cpc.2015.11.009</a>.</p>
</div><div id="ref-Yee"><p>Yee, Ks. 1966. “Numerical Solution of Initial Boundary Value Problems Involving Maxwells Equations in Isotropic Media.” <em>Ieee Transactions on Antennas and Propagation</em> Ap14 (3): 302–7.</p>
</div></div></div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="amr.html" class="btn btn-neutral float-right" title="Mesh refinement" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="intro.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, WarpX collaboration

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>